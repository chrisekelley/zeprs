<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- saved from url=(0049)http://www.ictedge.org/print/book/export/html/824 -->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" class="js"><script id="tinyhippos-injected">if (window.top.ripple) { window.top.ripple("bootstrap").inject(window, document); }</script><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    
    <!--<base href="http://ictedge.org/zeprs/book">--><base href=".">
    <title></title>
    <script type="text/javascript" src="./zeprs_files/jquery.js"></script><style type="text/css"></style>
<script type="text/javascript" src="./zeprs_files/drupal.js"></script>
<script type="text/javascript" src="./zeprs_files/googleanalytics.js"></script>
<script type="text/javascript" src="./zeprs_files/panels.js"></script>
<script type="text/javascript" src="./zeprs_files/shCore.js"></script>
<script type="text/javascript" src="./zeprs_files/shBrushJScript.js"></script>
<script type="text/javascript" src="./zeprs_files/shBrushJava.js"></script>
<script type="text/javascript" src="./zeprs_files/shBrushSql.js"></script>
<script type="text/javascript" src="./zeprs_files/shBrushXml.js"></script>
<script type="text/javascript" src="./zeprs_files/syntaxhighlighter.min.js"></script>
<script type="text/javascript" src="./zeprs_files/extlink.js"></script>
<script type="text/javascript" src="./zeprs_files/jquery.bgiframe.min.js"></script>
<script type="text/javascript" src="./zeprs_files/hoverIntent.js"></script>
<script type="text/javascript" src="./zeprs_files/supposition.js"></script>
<script type="text/javascript" src="./zeprs_files/supersubs.js"></script>
<script type="text/javascript" src="./zeprs_files/superfish.js"></script>
<script type="text/javascript" src="./zeprs_files/script.js"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, { "basePath": "/", "googleanalytics": { "trackOutgoing": 1, "trackMailto": 1, "trackDownload": 1, "trackDownloadExtensions": "7z|aac|arc|arj|asf|asx|avi|bin|csv|doc|exe|flv|gif|gz|gzip|hqx|jar|jpe?g|js|mp(2|3|4|e?g)|mov(ie)?|msi|msp|pdf|phps|png|ppt|qtm?|ra(m|r)?|sea|sit|tar|tgz|torrent|txt|wav|wma|wmv|wpd|xls|xml|z|zip" }, "syntaxhighlighter": { "clipboard": "/sites/all/libraries/js/syntaxhighlighter_2.1.364/scripts/clipboard.swf" }, "extlink": { "extTarget": 0, "extClass": "ext", "extSubdomains": 1, "extExclude": "", "extInclude": "", "extAlert": 0, "extAlertText": "This link will take you to an external web site. We are not responsible for their content.", "mailtoClass": "mailto" } });
//--><!]]>
</script>
        <meta name="robots" content="noindex, nofollow">
    <link rel="shortcut icon" href="http://ictedge.org/files/fusion_starter_favicon.jpg" type="image/x-icon">
    <link type="text/css" rel="stylesheet" media="all" href="./zeprs_files/aggregator.css">
<link type="text/css" rel="stylesheet" media="all" href="./zeprs_files/book.css">
<link type="text/css" rel="stylesheet" media="all" href="./zeprs_files/node.css">
<link type="text/css" rel="stylesheet" media="all" href="./zeprs_files/defaults.css">
<link type="text/css" rel="stylesheet" media="all" href="./zeprs_files/system.css">
<link type="text/css" rel="stylesheet" media="all" href="./zeprs_files/system-menus.css">
<link type="text/css" rel="stylesheet" media="all" href="./zeprs_files/user.css">
<link type="text/css" rel="stylesheet" media="all" href="./zeprs_files/content-module.css">
<link type="text/css" rel="stylesheet" media="all" href="./zeprs_files/ctools.css">
<link type="text/css" rel="stylesheet" media="all" href="./zeprs_files/date.css">
<link type="text/css" rel="stylesheet" media="all" href="./zeprs_files/filefield.css">
<link type="text/css" rel="stylesheet" media="all" href="./zeprs_files/geshifilter.css">
<link type="text/css" rel="stylesheet" media="all" href="./zeprs_files/menu_icons.css">
<link type="text/css" rel="stylesheet" media="all" href="./zeprs_files/panels.css">
<link type="text/css" rel="stylesheet" media="all" href="./zeprs_files/shCore.css">
<link type="text/css" rel="stylesheet" media="all" href="./zeprs_files/shThemeDefault.css">
<link type="text/css" rel="stylesheet" media="all" href="./zeprs_files/extlink.css">
<link type="text/css" rel="stylesheet" media="all" href="./zeprs_files/fieldgroup.css">
<link type="text/css" rel="stylesheet" media="all" href="./zeprs_files/views.css">
<link type="text/css" rel="stylesheet" media="all" href="./zeprs_files/print.css">
  <style>[touch-action="none"]{ -ms-touch-action: none; touch-action: none; }[touch-action="pan-x"]{ -ms-touch-action: pan-x; touch-action: pan-x; }[touch-action="pan-y"]{ -ms-touch-action: pan-y; touch-action: pan-y; }[touch-action="scroll"],[touch-action="pan-x pan-y"],[touch-action="pan-y pan-x"]{ -ms-touch-action: pan-x pan-y; touch-action: pan-x pan-y; }</style><script>window["_GOOG_TRANS_EXT_VER"] = "1";</script></head>
  <body class="syntaxhighlighter-processed">
        <div class="print-logo"><img class="print-logo" src="./zeprs_files/fusion_starter_logo.png" alt="ICTedge" id="logo">
</div>
    <div class="print-site_name">Published on <em>ICTedge</em> (<a href="http://ictedge.org/" class="ext">http://ictedge.org</a><span class="ext"></span>)</div>
    <p>
    </p><div class="print-breadcrumb"><a href="http://ictedge.org/" class="ext">Home</a><span class="ext"></span> &gt; ZEPRS Documentation Book</div>
    <hr class="print-hr">
    <h1 class="print-title"></h1>
    <div class="print-submitted">By <em>ckelley</em></div>
    <div class="print-created">Created <em>01/07/2010 - 13:14</em></div>
    <div class="print-content"><div id="node-824" class="section-1">
  <h1 class="book-heading">ZEPRS Documentation Book</h1>
  <div class="field field-type-text field-field-feature-teaser">
    <div class="field-items">
            <div class="field-item odd">
                    <p>Documentation specific to the ZEPRS implementation of Zcore</p>        </div>
        </div>
</div>
<p>This book contains documentation specific to the ZEPRS implementation of Zcore. For an overview of Zcore, the platform on which ZEPRS is built, please refer to the <a href="http://ictedge.org/zdocs" class="ext">Zcore Documentation Book</a><span class="ext"></span> <span class="print-footnote">[1]</span>.</p>  <div id="node-826" class="section-2">
  <h1 class="book-heading">Basic Concepts</h1>
  <p>Basic Concepts section</p>  <div id="node-672" class="section-3">
  <h1 class="book-heading">How to use ZEPRS for patient care</h1>
  <p>Please note:  ZEPRS has grown alot since this document was written in 11/8/2005; however, the basic ideas still hold.
</p>
<p><span style="font-weight: bold;">Overview</span><br>
</p>

<p class="Standard">The ZEPRS system is pretty easy to use – the system
feeds you all of the forms you need to fill out. Usually, if it stops
feeding you forms, you’re done w/ your session on ZEPRS. </p>
<p class="Standard"></p>
<p class="Standard">Here are the main things you would need to know:</p>
<ul class="listlevel1WW8Num5">

<li>
<p class="Standard">Login to the system, search for your patient. Click link to begin working with your patient.</p>
</li>
<li>
<p class="Standard">Usually the system will load the correct form. If you need to do something else, the navigation is easy to understand:</p>
<ul class="listlevel2WW8Num5">
<li>
<p class="Standard">The Home link lets you find another patient.</p>
</li>
<li>
<p class="Standard">The second section of links are for the forms you use during most patient visits. They correspond to the phases of pregnancy.</p>
</li>
<li>

<p class="Standard">The third section of links provide forms for
ancillary information about the patient, like demographics, patient
history, labs, etc. If your patient is at UTH, you can check her status
from this section as well.</p>
</li>
<li>
<p class="Standard">If the patient has any infants, you may click the links to the infant record in the next section.</p>
</li>
<li>
<p class="Standard">When you’re done with your shift, please click the last link – logout.</p>
</li>
</ul>
</li>
</ul>
<p class="Standard"></p>
<p class="Standard">After a form is submitted, the ZEPRS system checks
the data to see if it should alert the clinician of any issues, suggest
a referral to UTH, or inform you what forms need to be filled out next
(Missing forms). The ZEPRS system presents a small task list (or to-do
list) to the right of every form that displays these alerts. If you
click on one of these links, you are taken to the Problem list, where
you can comment on the problem, mark the problem as inactive, or view
the record that triggered the problem.</p>

<p class="Standard"></p>  <div id="node-680" class="section-4">
  <h1 class="book-heading">Conclusion</h1>
  <p class="Standard"></p>

<p class="Standard">The ZEPRS application follows the three main phases
of pregnancy: Antepartum, Labour, and Postnatal. Just as the fetus lets
the mother know when she’s ready to be born, so does the ZEPRS system
help pace you through the system. If you keep this concept in mind,
you’ll be able to work confidently with this system!</p>
  </div>
<div id="node-106" class="section-3">  </div>
<div id="node-679" class="section-4">
  <h1 class="book-heading">Delivery/Postnatal Care</h1>
  <p class="Standard"></p>
<p class="Standard">The delivery Summary form has two parts. First, you
need to identify the newborns in the section at the top of the page
dedicated to that task. Next, you provide any other delivery summary
information in the section below. </p>
<p class="Standard"></p>
<p class="Standard">After you submit the delivery summary form, the system will feed you a series of forms that lead to discharging the mother:</p>
<ul class="listlevel1WW8Num11">
<li>
<p class="Standard">Puerperium</p>
</li>

<li>
<p class="Standard">Infant discharge summary or Still birth record</p>
</li>
<li>
<p class="Standard">Maternal discharge summary</p>
</li>
</ul>
<p class="Standard"></p>
<p class="Standard">If there were any problems during the course of delivery, the system will feed you a Postnatal Infant or Maternal Visit form. </p>
<p class="Standard"></p>
<p class="Standard">After the Maternal Discharge Summary is submitted,
the system sends you to the Delivery Summary task list, which indicates
that you’re done.</p>
<p class="Standard"></p>
<p class="Standard">If the next visit for this patient is a typical
postnatal visit, fill out a Postnatal Maternal visit form, as well as a
Postnatal Infant form. Here’s how you access these forms:</p>

<ul class="listlevel1WW8Num3">
<li>
<p class="Standard">Postnatal Maternal visit form: click “Delivery/Postnatal” link on side nav, and select this form.</p>
</li>
<li>
<p class="Standard">Postnatal Infant form: click the link to the infant
on the left nav strip, and then click “Delivery/Postnatal” link on side
nav, and select this form.</p>
</li>
</ul>
<p class="Standard"></p>
<p class="Standard">Most of the forms you’ll need during postnatal care
are available from the “Delivery/Postnatal” link on the left nav. Just
keep in mind that if you need to submit a form for the infant, be sure
to click the link to the infant from the left nav, if you’re currently
viewing the mother. Of course, you may also click the link to the
infant from the home page if it’s displayed in the search results.</p>
<p class="Standard"></p>  </div>
<div id="node-678" class="section-4">
  <h1 class="book-heading">Labour</h1>
  <p class="Standard"></p>
<p class="Standard">If the patient is in Labour, click the link to Problem/Labour Visits.
Submit the form, keeping in mind that if dilatation entered in this
form is less than 4, the system will display the Observations for
Latent phase form. If dilatation is greater, it will bring you to the
partograph, which is very similar to the partogrpah in the blue book.
Instead of marking the bluebook with a pen, simply click on the chart
to make an entry.</p>

<p class="Standard"></p>
<p class="Standard">Once the patient has delivered, click the link at
the bottom of the page (Patient has delivered.) This will send you to
the Delivery Summary form</p>
<p class="Standard"></p>  </div>
<div id="node-681" class="section-4">
  <h1 class="book-heading">Patient workflow in a clinic: the need for a network</h1>
  <p>The need for a network within a clinic is demonstrated by the
folllowing quote from Dr. Perry Killam, who is managing the ZEPRS
deployment in Lusaka:</p>
<p>"Typically a patient might have her record documented on by several
computers within the clinic. The clerk might use a different computer
than the midwife. The computer that prints the antenatal card may be
different from the one used to fill in her labs.Â So, I think that the
computers within the MCH clinic need to have real time updating." </p>
<p>Patients generally do not go from MCH to LW; however, "if the MCH
printer isn't working, they might go to Labor Ward to print the
antenatal card and vice versa for the LW."</p>

  </div>
<div id="node-24" class="section-3">  </div>
<div id="node-673" class="section-4">
  <h1 class="book-heading">How do I fill out a form?</h1>
  <p class="Standard"></p>
<p class="Standard">The forms in ZEPRS are not too different from the
forms in the referral application. Some of the forms have “collapsing
sections” which means you need to click on the section name to see the
fields to fill out. These sections have a plus sign in front of them.
If you select “Other” in a dropdown, another field may appear that
displays a text entry box. You do not need to fill out all of the
fields on a form. We designed the ZEPRS system with collapsing section
so that if a section is not applicable to your current exam, you may
skip it. Enter only the information you deem clinically appropriate.
Click the “Submit” button at the bottom of the form to save the data.
(Some forms may use different wording, but they all do the same thing –
they save the data you’ve entered and send you to the next form.)</p>
<p class="Standard"></p>
<p class="Standard">Some of the forms work a little differently. The
Newborn Evaluation form is generated automatically by the system during
the delivery summary process. When you review and make entries on the
Newborn Evaluation form, you must double-click on each field to enter
data. When you see a form that behaves in this manner, you are in
“Edit” mode. But this does not need to be confusing if you keep these
two points in mind:</p>
<p class="Standard"></p>
<ul class="listlevel1WW8Num8">
<li>
<p class="Standard">If there are no input widgets on the page, double-click to make them appear.</p>
</li>
<li>
<p class="Standard">If there are widgets on the page, fill out the form as normal.</p>

</li>
</ul>
<p class="Standard"></p>  </div>
<div id="node-674" class="section-4">
  <h1 class="book-heading">How do I make a referral?</h1>
  <p class="Standard"></p>
<p class="Standard">Referrals are built into the ZEPRS application –
each form has an option in Disposition for “Refer to UTH”. Select that
option if you need to make a referral. Done!</p>
<p class="Standard"></p>  </div>
<div id="node-675" class="section-4">
  <h1 class="book-heading">What is the usual process for using the ZEPRS system?</h1>
  <p class="Standard"></p>
<p class="Standard">If it’s the patient’s first visit, you’ll need to
fill out the New Patient form is she’s not available from the Search.
After you submit this form, the system will feed you a series of forms,
one after another, which are used to gather patient history. There are
similar to the forms you fill out in the Blue book:</p>
<ul class="listlevel1WW8Num4">
<li>
<p class="Standard">Pregnancy Dating – This form helps you identify the patient’s EGA</p>

</li>
<li>
<p class="Standard">Previous pregnancies</p>
</li>
<li>
<p class="Standard">Medical/Surgical history</p>
</li>
<li>
<p class="Standard">Current medicine (If necessary)</p>
</li>
</ul>
<p class="Standard"></p>
<p class="Standard">Once you’re done with these forms, you may begin your typical exams:</p>

<ul class="listlevel1WW8Num7">
<li>
<p class="Standard">Routine Antenatal visit</p>
</li>
<li>
<p class="Standard">Initial Visit Physical exam</p>
</li>
<li>
<p class="Standard">Safe motherhood Care</p>
</li>
</ul>
<p class="Standard"></p>
<p class="Standard">At this point, you’re done for this session.</p>

<p class="Standard"></p>  </div>
<div id="node-676" class="section-4">
  <h1 class="book-heading">Subsequent Visits</h1>
  <p class="Standard"></p>
<p class="Standard">The next time you open this patient’s record, the
system will automatically display the Routine Antenatal Chart. After
you complete your entry in that chart, the system sends you to the Safe
motherhood section. Update any Safe motherhood info (labs, drugs
dispensed) and you’re done.</p>
<p class="Standard"></p>  </div>
<div id="node-677" class="section-4">
  <h1 class="book-heading">Unscheduled Visits</h1>
  <p class="Standard"></p>
<p class="Standard">If the patient has made an unscheduled visit, click the link to “Problem/Labour Visits.” </p>
<p class="Standard"></p>  </div>
</div>
<div id="node-682" class="section-3">
  <h1 class="book-heading">Pregnancies</h1>
  <p>The concept of pregnancy is central to the ZEPRS application -
it affects how the patient record is viewed, because the clinician is
usually interested in records relating to a particular pregnancy
(usually the current one). Most persistence operations should keep this
in mind. For example, if you are doing a search for values to populate
the patient chart, make sure you’re filtering by the correct pregnancy.
Even though the patient is currently pregnant, the user may be viewing
records from a previous pregnancy.</p>
<p>Since women can have multiple pregnancies, there is a Pregnancy
object to track these situations. Each EncounterRecord (metadata for
each form), outcome, and problem has a pregnancy property. Whenever a
form is submitted, the patient’s current pregnancy is persisted in the
encounters table, in PatientStatusRecord (patient_status, as
current_pregnancy_id). If there is not a pregnancy object for a mother
when a form is submitted, a new instance is persisted and linked via
patientStatusReport. datePregnancyBegin is set to the
encounter.getDateVisit(); however, it would be better to use LMP or
similar. </p>
<p>When an encounter is edited, it does not matter if the pregnancy has
ended - don’t mistakenly create a new pregnancy. In fact, we’re not
even checking getPatientStatusreport().getCurrentPregnancy() for
EncounterCorrections.</p>
<p>Need to check getPatientStatusreport().getCurrentPregnancy() for
every new form submission, because it is not certain which will the
first form used when starting a new pregnancy. This avoids hard-coding
form id's into the system.</p>
<p>Do not assume that all patients are pregnant - a child of a patient cannot be pregnant (at least for the next 10-13 years). </p>

<p>The following forms are updated from pregnancy-to-pregnancy:</p>
<ul style="margin-top: 0in;">
<li>Demographics (patient registration) </li>
<li>Previous Pregnancy<ul style="margin-top: 0in;">
<li>This  chart lists all non-ZEPRS pregnancies as well as ZEPRS pregnancies.</li>
</ul></li>

<li>Medical/Surgical History</li>
<li>Current Medicine</li>
<li>SMC</li>

</ul>  <div id="node-683" class="section-4">
  <h1 class="book-heading">Navigating Pregnancies</h1>
  <div class="field field-type-text field-field-feature-teaser">
    <div class="field-items">
            <div class="field-item odd">
                    <p>&nbsp;</p>        </div>
        </div>
</div>
<p class="MsoNormal">Use the previous pregnancies form to navigate ZEPRS pregnancies.</p> <p class="MsoNormal"><img height="292" width="605" style="border: 1px solid black;" title="Previous Pregnancies selection" alt="Previous Pregnancies selection" src="./zeprs_files/prevPregnanciesSelection.gif"></p><p class="MsoNormal">If the patient returns with a new pregnancy and still has an open pregnancy, click "Close" link:</p><p class="MsoNormal"><img height="179" width="600" style="border: 1px solid black;" title="Close pregnancy link" alt="Close pregnancy link" src="https://www.ictedge.org/files/prev_pregnancies2.png"></p> <p class="MsoNormal">Test Cases:</p> <ul> <li>Close current pregnancy. Open patient, view Preg. Dating form. Click hist/dating, choose Prev. pregs. Now it displays "Return to current pregnancy" along w/ list of prev. pregs. If you click "Return to current preg." it displays Preg. Dating form, since you have not yet begun Preg. Dating for this new pregnancy. Submission of this form "begins" each new pregnancy.</li>  <li>Now, click one of the prev. pregs To get back to the new preg click "Return to current preg" link.</li> <li>Create patient (submit Registration form) without submitting Pregnancy Dating form.</li> </ul>  </div>
<div id="node-684" class="section-4">
  <h1 class="book-heading">Pregnancy Conclusion</h1>
  <p>The form "Pregnancy Conclusion" is used to terminate a pregnancy
and persist values for the pregnancy end date and comments. These
values are persisted by FormDAO whenever form71 is submitted. The field
id’s are hardcoded, so be careful.</p>

<p>PatientStatus has a currentPregnancy attribute for each patient. The following objects have pregnancy attributes:</p>
<ul>
<li>EncounterData      (encounter table)</li>
<li>Problem</li>
<li>Comments</li>
</ul>
<p>When a patient is loaded (after clicking link to patient) the
current pregnancy is loaded into the session by PatientRecordAction. If
the "pregnancy" key is sent in the request, that particular pregnancy
is loaded into the session. If the current pregnancy is complete (if
patient.getPatientStatusreport().getCurrentPregnancy().getDatePregnancyEnd()
!= null), then the zeprs session object "pregnancy" is set to a new
instance of an empty pregnancy object by PatientHomeAction. This forces
the interface to reduce the link options on the left nav, provide the
form to create a new pregnancy (Pregnancy Dating), and a link to
History. Within the History section user may peruse Previous
Pregnancies form to navigate other pregnancies that are in the ZEPRS
system.</p>

<p>If you want to check if the pregnancy loaded into the session is active, try this:</p>
<p>&lt;c:when test=\"${empty zeprs_session.datePregnancyEnd}\"&gt; </p>
<p>This is used to prevent any form entry when viewing a previous pregnancy. </p>
<p>If you are viewing a previous pregnancy, you may not create new problems; however, you may comment on a problem.</p>
<p>In the ZEPRS app, submitting the Newborn Evaluation form (form23)
creates a new patient, with the parent_id of the current patient loaded
in the session. This is done via DWR - there’s a small subform on the
top of the Delivery Summary page that is used to create a newborn. This
calls the remote class Newborn. PatientRecordUtils.createNewborn
handles the db persistence.</p>
<p>Links to mother/children are in the Previous Pregnancies chart.</p>
<p>The form "Newborn Evaluation" creates a new patient (the infant) in
the system. The application sets the Pregnancy of the infant equal to
the mother’s pregnancy in FormDAO:</p>

<div class="codeblock"><span class="geshifilter"><code class="geshifilter-text">infant.getPatientStatusreport().setCurrentPregnancy(mothersCurrentPregnancy); </code></span> </div>
  </div>
</div>
<div id="node-110" class="section-3">  </div>
</div>
<div id="node-686" class="section-3">
  <h1 class="book-heading">Flow</h1>
  <p>As mentioned in the overview, ZEPRS guides the clinician through
the patient care process by feeding the most appropriate form after
each form submission, depending on the data entered. The forms provided
to the user correspond roughly to the phase of pregnancy the user is
in:
</p><ul>
<li>History      (generally, forms used to collect patient history are filled out on the      first visit)</li>
<li>Antepartum      - Routine antenatal visits</li>
<li>Safe motherhood - during the antepartum flow, the system always
sends user to the main Safe Motherhood form, to make sure that that
care is given. Within the Safe Motherhood section there are links to SM
care-related forms such as ARV Regimen, Labs, and Drugs.</li>
<li>Intrapartum (Labour) - problem visits leading up to labour and partograph</li>
<li>Delivery      Summary/Postnatal - Delivery summary, problem visits, and disposition</li>

</ul>
<p>&nbsp;</p><p> There are a few more flows used in the ZEPRS system to
collect data, but they are not part of the usual flow process. In other
words, the user has to click on them to reach them - they are not
automatically served by the system.
</p><ul>
<li>Ultrasound</li>
<li>UTH      Admissions</li>
<li>NICU -      infant forms used in UTH NICU postnatal care.</li>
</ul>
<p>&nbsp;</p><p> Sometimes the application deviates slightly from the flow.
For example, if the patient has marked "Patient is on ARV's", the ARV
Regimen form is presented. When the ARV Regimen page is submitted, the
application continues on its normal path. The system used to have an
automated flow system, which worked fine when requirements were simple.
Unfortunately, the app has gotten a lot more complicated; therefore,
flows from form-to-form are hard-coded in FormAction (createForward)
and ForwardAction. Ideally, the app will send user to another form;
however, sometimes the app can only send the user to a task list from
which the user much choose the correct form. The application stores the
current form (and flow) in patient_status table. When the user loads a
patient, the app uses the value of the current flow id to determine
what form to provide the user. This process is defined in
PatientHomeAction. In general, the main values that determine changes
to flow are:
</p><ul>

<li>Disposition      - admit to active labour, for example</li>
<li>Cervix      Dilatation &gt;=4</li>
<li>Problem      field checked</li>
<li>Patient      is on ARV's checked</li>
</ul>
<p>&nbsp;</p>
<p>The doc <a href="http://ictedge.org/node/689" class="ext">Rules for Flows</a><span class="ext"></span> <span class="print-footnote">[2]</span>
details a few of the flows. Be sure to check FormAction.createForward
to see if any of these have been revised. Also, these flows are
collected in the Visio - Updated Site Map.vsd.</p>  <div id="node-687" class="section-4">
  <h1 class="book-heading">Fixing flow problems</h1>
  <p>Sometimes a clinician accidentally submits a delivery summary
form. Submitting the delivery summary form sets the user flow to
Delivery Summary/Postnatal (id=4). there is not an automated way to
"reset" a patient flow. Best way out of this situation is to do the
following:</p>
<p>Delete the incorrect encounter, such as Delivery Summary.</p>
<p>Open up mysql.</p>
<p>Get the patient id:</p>

<p>select * from patient where district_patient_id = 'xxx'\G;</p>
<p>The get a list of the encounter id's</p>
<p>select id, form_id, created from encounter where patient_id=xxx order by id;</p>
<p>Get the patient status</p>
<p>select * from patient_status where id = xxx\G;</p>
<p>Then update the patient_status with the most recent legitamate
encounter. In the following example, the patient is in antenatal flow
(id=1):</p>
<p>update patient_status set current_flow=1, current_flow_encounter_id=xxx where id = xxx </p>

  </div>
<div id="node-59" class="section-4">  </div>
<div id="node-688" class="section-4">
  <h1 class="book-heading">New Patient Flow</h1>
  <p>ZEPRS provides a wizard-style series of forms when processing a
patient through the intial visit. The most appropriate form is
presented after each form submission. Forms are presented in the
following order:</p>
<ul>
<li>Patient Registration and Identification</li>
<li>Pregnancy Dating</li>
<li>Previous Pregnancies - can add additional pregnancies. Click Done to proceed to next form.</li>
<li>Medical/Surgical History - clicking "Currently Taking medicine" will take user to Current Medicine page</li>

<li>Current Medicine (only if Currently Taking medicine" clicked in Medical/Surgical History)</li>
<li>Routine Antenatal Visits - click "Problem?" takes to Problem or Labour visit page</li>
<li>Initial Visit Physical Exam - This form is submitted only *once*for
a patient. A new Initial Visit Physical Exam is not submitted with each
new pregnancy.</li>
<li>Safe Motherhood Care</li>
</ul>
<p>&nbsp;</p>
<p>&nbsp;</p>
  </div>

<div id="node-60" class="section-4">  </div>
<div id="node-689" class="section-4">
  <h1 class="book-heading">Rules for Flows</h1>
  <p>Some of the rules for flow processing follow, to give you an idea of some of the more complex flows.</p>
<p><b>Antenatal flow</b></p>
<p><o:p> </o:p>The most important value collected in Antepartum is the
EGA; several forms throughout the ZEPRs application depend on this
value; therefore, the app collects this value in the Pregnancy Dating
form ASAP. </p>
<p><b>Problem or labour visit form: <o:p></o:p></b></p>
<ul type="\&quot;disc\&quot;">
<li>if "Referral"   selected in disposition, create referral problem and send to problem or labour task list</li>

<li>if "Admit to uth"  selected in disposition, create referral (admit) problem and send to problem or labour task list</li>
<li>Next, the logic gets short-circuited if &gt;= 4  - Send to partograph, no matter what is chosen</li>
<li>if "admit for active labour field" selected in disposition, check cervixDilatation field. </li>
<ul type="\&quot;circle\&quot;">
<li>if &gt;= 4 - send to  partograph - this would have already been done, as per short-circuit rule  above.</li>

<li>if &lt; 4, send to  labourObservations</li>
</ul>
<li>if "Admit for Observations" selected in disposition, check cervixDilatation field.</li>
<ul type="\&quot;circle\&quot;">
<li>if &gt;= 4 - send to  partograph - this would have already been done, as per short-circuit rule  above.</li>
<li>if &lt; 4, send to  labourObservations</li>

</ul>
<li>if "Discharge to home" selected</li>
<ul type="\&quot;circle\&quot;">
<li>if  initial visit  physical exam has been submitted, send user to routine antenatal chart</li>
<li>else send to initial  visit physical exam</li>
</ul>
<li>if no value for disposition, </li>
<ul type="\&quot;circle\&quot;">
<li>if  initial visit  physical exam has been submitted, send user to routine antenatal chart</li>

<li>else send to initial  visit physical exam</li>
</ul>
</ul>
<p><b>Labour observations form:<o:p></o:p></b></p>
<ul type="\&quot;disc\&quot;">
<li>if "Referral" selected in disposition, create referral problem and send to problem or labour task list</li>
<li>Next, the logic gets short-circuited if &gt;= 4  - Send to partograph, no matter what is chosen for disposition</li>
<li>if "Discharge to home" selected, send to problem or labour task list</li>

<li>if "Admit for active labour (Begin Partograph)" selected</li>
<ul type="\&quot;circle\&quot;">
<li>if &gt;= 4 - send to  partograph - this would have already been done, as per short-circuit rule  above.</li>
<li>if &lt; 4, send back  to labourObservations</li>
</ul>
<li>If "Continue observations" selected, send back to labourObservations</li>

<li>If nothing selected, send back to labourObservations. This used to
send user back to "Problem or labour" task list, but I think it makes
more sense to keep user in labourObservations form if they don't
dispose.</li>
</ul>
<p><span style="font-weight: bold;">Postnatal flow</span></p>

<p>Delivery summary form -&gt; newborn eval. </p>
<p>(Please note that only the mother can post a Delivery Summary form.
Somehow two patient records (out of 35,000) for infants also have
Delivery Summary forms submitted. The normal system flow prevents this
from happening, but even if the user tries to play with the URL, the
system prevents this such an action. See error handling code in
zeprs.js: fillForm function, Newborn.createNewborn, FormDisplayAction,
and FormAction. ) </p>
<p>Newborn eval: when completed is clicked, ForwardAction checks values
for "Alive/Stillbirth" and "Patient received ARV’s." and routes
accordingly. If there are multiple fetuses delivered, we keep track of
each newborn eval submitted in SessionPatient.setNewbornEvalsCompleted.
</p>

<p>Discharge (similar to newborn eval) :in case of multiple fetuses, stores list of newborns that have already had discharges.</p>
  </div>
</div>
<div id="node-119" class="section-3">  </div>
</div>
<div id="node-690" class="section-3">
  <h1 class="book-heading">Patient Death</h1>
  <p>The following forms set the patient's status as "dead:"</p>
<ul>
<li>Maternal Death - Disposition field</li>

<li>Postnatal Infant Visit - Infant status field</li>
<li>Infant Problem/Postnatal Visit - Infant status field</li>
</ul>
<p>This status is reflected in the patient search "Dead?" column and is stored in the "dead" field in the patient table.</p>  </div>
<div id="node-691" class="section-3">
  <h1 class="book-heading">ARV care</h1>
  <p>ARV data entry is provided in the <a href="http://ictedge.org/node/727" class="ext">Safe Motherhood</a><span class="ext"></span> <span class="print-footnote">[3]</span>
section. Some of this data is summarised in the Antenatal and Postnatal
cards, which are linked from the Demographics page. The HIV status and
ARV information is coded:</p>
<p><img src="./zeprs_files/smc-stamp.gif" alt="SMC Stamp" title="SMC Stamp"></p>
<p>Abbreviations:</p>
<ul>
<li>PCR: Pretest Counseled Refused</li>
<li>PCA: Pretest Counseled Accepted</li>
<li>TA: Test Refused</li>
<li>TA: Test Accepted</li>
<li>NR: Not Reactive (Patient is HIV -)</li>
<li>R: Reactive (Patient is HIV+)</li>
<li>I: Indeterminate</li>
<li>MGA: Mother Given ARV</li>
<li>IGA: Infant Given ARV</li>
<li>MRA: Mother refused ARV</li>
<li>INGA: Infant Not Given ARV</li>
<li>IFB: Infant feeding choice by mother is Breast Feeding</li>
<li>IFR: Infant feeding choice by mother is Replacement Feeding</li>
<li>TT: Tetanus Toxoid Vaccination</li>
<li>ITN: Sleeps under Insecticide-treated net</li>
</ul>
<p>ZEPRS provides several reports that may be used for ARV care; for example, the <a href="http://ictedge.org/node/721" title="Eligible for ARV&#39;s report" class="ext">Eligible for ARV's report</a><span class="ext"></span> <span class="print-footnote">[4]</span> may be used to help manage eligble patients. See the <a href="http://ictedge.org/node/718" title="Reports section" class="ext">Reports</a><span class="ext"></span> <span class="print-footnote">[5]</span> section for other ARV related reports.</p>  <div id="node-692" class="section-4">
  <h1 class="book-heading">Newborn ARV care</h1>
  <div class="field field-type-text field-field-feature-teaser">
    <div class="field-items">
            <div class="field-item odd">
                    <p>&nbsp;</p>        </div>
        </div>
</div>
<p>The Newborn Evaluation and Infant Discharge Summary forms provide an opportunity to enter data relating to newborn ARV care in the Infant Immunizations and Medication section:</p> <p><img title="Newborn Eval. Immunization section" alt="Newborn Eval. Immunization section" src="./zeprs_files/newborn_eval_immun.jpg"></p>  <p>----</p> <p><img title="Infant Discharge Summary Immunization section" alt="Infant Discharge Summary Immunization section" src="./zeprs_files/infant_disch_immun.jpg"></p> <p>The system will notify the clinician if NVP has not been administered to the newborn if the mother is HIV positive.</p> <p><img title="System notification - No NVP given" alt="System notification - No NVP given" src="./zeprs_files/newborn_no_nvp_given.jpg"></p> <p>There are additional opportunities to enter HIV care records in the Infant Postnatal Visit form.</p> <p><img title="Infant Postnatal ARV care" alt="Infant Postnatal ARV care" src="./zeprs_files/infant_postnatal_arv.jpg"></p>      <div class="section-2" id="node-92">&nbsp;</div>  </div>
</div>
</div>
<div id="node-643" class="section-2">
  <h1 class="book-heading">Database Schema</h1>
  <p>The Zcore database, which is named zeprs, can be divided up into the following sections:</p> <ul> <li>Dynasite -data used to render forms/fields/enumerations</li> <li>Encounters - stores data about encounters</li> <li>Permissions - users/groups</li> </ul> <p>You may view a <a href="http://ictedge.org/files/resources/zeprs_documentation/zeprs-schema.htm" class="ext">version of the ZEPRS schema</a><span class="ext"></span> <span class="print-footnote">[6]</span> created on 10 October 2008 using <a href="http://www.webyog.com/en/" class="ext">SQLYog </a><span class="ext"></span> <span class="print-footnote">[7]</span>as well as follow the links below to get more information about ZEPRS database design.</p>  <p>Please note that some of the form fields in zeprs are <a href="http://ictedge.org/node/756" class="ext">shared</a><span class="ext"></span> <span class="print-footnote">[8]</span> - used in other forms. (<a href="http://ictedge.org/files/resources/demos/sharedFields" class="ext">Screencast on shared fields</a><span class="ext"></span> <span class="print-footnote">[9]</span>) Unfortunately, the form listing (zeprs_fields.xls) does not display shared fields. The simple listing of form field labels to tables (zeprs_shared_fields.xls attached below) may be useful in associating shared fields to tables.</p> <table class="sticky-enabled" id="attachments"> <thead> <tr> <th>Attachment</th> <th>Size</th> </tr> </thead> <tbody>  <tr class="odd"> <td><a href="http://ictedge.org/files/zeprs_fields.xls" class="ext">zeprs_fields.xls</a><span class="ext"></span> <span class="print-footnote">[10]</span></td> <td>237 KB</td> </tr> <tr class="even"> <td><a href="http://ictedge.org/files/zeprs_shared_fields.xls" class="ext">zeprs_shared_fields.xls</a><span class="ext"></span> <span class="print-footnote">[11]</span></td> <td>87 KB</td> </tr> </tbody> </table> <p>&nbsp;</p> <p>The <a href="http://ictedge.org/node/165" class="ext">Derby Database Schema</a><span class="ext"></span> <span class="print-footnote">[12]</span> section has updated information on the schema used in the standalone.</p>  <div id="node-644" class="section-3">
  <h1 class="book-heading">Data Sources</h1>
  <p>Data sources are setup in META-INF\context.xml. <em>In the past they were configured</em> via server.xml.</p>
<p>Resources:</p>
<ul>
<li> zeprsDB - Used for most queries to the zeprs db as APP (Zcore standalone using Derby) or zeprs_web_user (ZEPRS using MySQL)</li>
<li>adminDB - connects to admin db as root- MySQL-only</li>
<li>demoDB - connects to demo db as zeprs_demo_user- MySQL-only</li>
<li>zeprsDBadmin - connects to zeprs db as root for methods that
require special access to the database, such as delete capability or
schema change- MySQL-only</li>

</ul>  </div>
<div id="node-648" class="section-3">
  <h1 class="book-heading">Active tables in ZEPRS</h1>
  <p>Here's a sample model of the relationship between the encounter table and one of the table-backed forms:</p> <p><img title="ARV model" src="./zeprs_files/arv_model.gif" alt="ARV model"></p> <p>The encounter table stores metadata about each table-backed form. The following tables are form-backed tables; they have the same relationship with the encounter table as displayed in the model above.</p> <p>&nbsp;</p> <table border="0"> <tbody>  <tr> <th>Label</th> <th>Table name</th> </tr> <tr> <td>Patient Registration and Identification</td> <td>patientRegistration</td> </tr> <tr> <td>Previous Pregnancies</td> <td>prevPregnancies</td>  </tr> <tr> <td>Laboratory Results</td> <td>labResults</td> </tr> <tr> <td>Observations for Latent Phase of 1st Stage of Labour</td> <td>latentFirstStageLabour</td> </tr> <tr> <td>Newborn Evaluation</td> <td>newbornEval</td>  </tr> <tr> <td>Postnatal Maternal Visit</td> <td>postnatalMaternalVisit</td> </tr> <tr> <td>Postnatal Infant Problem Visit</td> <td>probPostnatalInfant</td> </tr> <tr> <td>UTH Neonatal Case Record</td> <td>uthNeonatalRecord</td>  </tr> <tr> <td>Infant Physical Examination</td> <td>infantPhysicalExam</td> </tr> <tr> <td>Still Birth Delivery Record</td> <td>stillbirthDeliveryRecord</td> </tr> <tr> <td>Antenatal Ultrasound Evaluation</td> <td>anteUltrasoundEval</td>  </tr> <tr> <td>Current Medicine</td> <td>currentMedicine</td> </tr> <tr> <td>Antenatal Hospitalization Summary</td> <td>antesum</td> </tr> <tr> <td>Problem or Labor Visit</td> <td>probLabor</td>  </tr> <tr> <td>Delivery Summary</td> <td>deliverySum</td> </tr> <tr> <td>Maternal Discharge Summary</td> <td>maternalDischarge</td> </tr> <tr> <td>Medical/Surgical History</td> <td>medSurgHist</td>  </tr> <tr> <td>Pregnancy Conclusion</td> <td>pregnancyEnd</td> </tr> <tr> <td>New Pregnancy</td> <td>pregnancyBegin</td> </tr> <tr> <td>Update EGA</td> <td>updateEGA</td>  </tr> <tr> <td>Postnatal Hospitalization Summary</td> <td>postnatalHosp</td> </tr> <tr> <td>Postnatal Ultrasound Evaluation</td> <td>postUltrasound</td> </tr> <tr> <td>NICU Hospitalization Summary Form</td> <td>nicuSummary</td>  </tr> <tr> <td>Initial Visit Physical Exam</td> <td>initialVisit</td> </tr> <tr> <td>Postnatal Maternal Problem Visit</td> <td>probPostnatal</td> </tr> <tr> <td>Partograph</td> <td>partographStatus</td>  </tr> <tr> <td>Routine Antenatal Visits</td> <td>routineAnte</td> </tr> <tr> <td>Puerperium</td> <td>puerperium</td> </tr> <tr> <td>Pregnancy Dating</td> <td>pregnancyDating</td>  </tr> <tr> <td>Create Referral</td> <td>createReferral</td> </tr> <tr> <td>Infant Discharge Summary</td> <td>infantDischargeSummary</td> </tr> <tr> <td>Postnatal Infant Visit</td> <td>postnatalInfant</td>  </tr> <tr> <td>General Lab Studies</td> <td>labTest</td> </tr> <tr> <td>Drug Interventions</td> <td>drugIntervention</td> </tr> <tr> <td>Regimen Given Today</td> <td>arvRegimen</td>  </tr> <tr> <td>RPR</td> <td>rpr</td> </tr> <tr> <td>Counseling Visit</td> <td>smCounselingVisit</td> </tr> <tr> <td>Safe Motherhood Care</td> <td>safeMotherhoodCare</td>  </tr> <tr> <td>Ultrasound Fetus Evaluation</td> <td>ultrasoundFetusEval</td> </tr> <tr> <td>Reasons for Referral</td> <td>referral_reasons</td> </tr> </tbody> </table> <table id="attachments" class="sticky-enabled"> <thead>  <tr> <th>Attachment</th> <th>Size</th> </tr> </thead> <tbody> <tr class="odd"> <td><a href="./zeprs_files/arv_model.gif" class="ext">arv_model.gif</a><span class="ext"></span> <span class="print-footnote">[13]</span></td> <td>18.74 KB</td> </tr> </tbody> </table>      <div id="node-224" class="section-3">&nbsp;</div>  </div>
</div>
<div id="node-169" class="section-2">
  <h1 class="book-heading">Improving Perinatal Care</h1>
  <div class="field field-type-text field-field-feature-teaser">
    <div class="field-items">
            <div class="field-item odd">
                    <p>The Zambia Electronic Perinatal Record System (ZEPRS) is being used by clinics and the University Teaching Hospital in Lusaka, Zambia to improve patient care.</p>        </div>
        </div>
</div>
<div class="field field-type-filefield field-field-thumbnail85x85">
      <div class="field-label">thumbnail:&nbsp;</div>
    <div class="field-items">
            <div class="field-item odd">
                    <div class="filefield-file"><img class="filefield-icon field-icon-image-jpeg" alt="image/jpeg icon" src="./zeprs_files/image-x-generic.png"><a href="http://ictedge.org/files/zeprs_referral_launch_medium.jpg" type="image/jpeg; length=12348" class="ext">zeprs_referral_launch_medium.jpg</a><span class="ext"></span> <span class="print-footnote">[14]</span></div>        </div>
        </div>
</div>
<p><img width="350" height="261" alt="Photo of paper patient records in a health facility in Lusaka, Zambia in 2002." title="Photo of paper patient records in a health facility in Lusaka, Zambia in 2002." style="float: right; margin: 3px 12px;" class="imageborderthin" src="./zeprs_files/zeprs_uth_paper_records.jpg">In Zambia in 2000 an estimated 750 out of every 100,000 mothers died in childbirth, while neonatal mortality was estimated at a rate of 40 in every 1,000 live births (WHO 2000). A women's lifetime risk of death in pregnancy was an estimated 1 in 25. Nearly 1/3 of pregnant women in Lusaka infected with HIV (Joint UAB-Zambian studies). Nearly half of these mothers would&nbsp; transmit HIV to their babies. (Joint UAB-Zambian studies). Virtually all modern health care for more than 1 million people was provided by 23 clinics and the University Teaching Hospital (UTH). All medical records were maintained on paper.</p><p>In early 2001 a team of physicians at the University of Alabama at Birmingham (UAB) and visiting Zambian physician Dr. Moses Sinkala conceived the idea based on a successful electronic perinatal record system that the UAB had developed and proven in clinics in Birmingham. In July 2001 the Bill &amp; Melinda Gates Foundation awarded a grant to the UAB to develop a similar system to serve public obstetric clinics in Lusaka, Zambia.<br><br>The UAB team solicited proposals for the technical design and implementation of the system from several private sector information technology firms, including Electronic Data Systems, before awarding a contract to RTI. Other project partners included the Center for Infectious Disease Research in Zambia (<a title="Link to the CIDRZ website." href="http://www.cidrz.org/" class="ext">CIDRZ</a><span class="ext"></span> <span class="print-footnote">[15]</span>) and the Lusaka District Health Management Team of the Zambian Central Board of Health.</p><h2>Solution</h2><p><img width="348" height="260" alt="ZEPRS team at the launch of the electronic referral system in 2005." title="ZEPRS team at the launch of the electronic referral system in 2005." style="float: right; margin: 3px 12px;" class="imageborderthin" src="./zeprs_files/zeprs_team_at_referral_launch.jpg">The Zambia Electronic Perinatal Record System (ZEPRS) is an Electronic Medical Record (EMR) system used by public obstetric clinics and a hospital (the University Teaching Hospital) in Lusaka, Zambia to improve patient care. The University of Alabama Birmingham (UAB) Center for Research in Women's Health (<a href="http://www.uab.edu/uasom/research/html/center_rschwomenshlth.htm" class="ext">CRWH</a><span class="ext"></span> <span class="print-footnote">[16]</span>), RTI, and the Center for Infectious Disease Research in Zambia (CIDRZ) developed ZEPRS with local medical expertise and project engagement from the Lusaka Urban Health District, Central Board of Health and funding support from the <a href="http://www.gatesfoundation.org/global-health/Pages/overview.aspx" class="ext">Bill &amp; Melinda Gates Foundation</a><span class="ext"></span> <span class="print-footnote">[17]</span>.</p><p>ZEPRS has been designed to improve maternal and perinatal outcomes by:</p><ol><li>Improving perinatal care to women and postnatal care to neonates by:</li><blockquote><ul><li>Promoting adherence to good standard of care practices <br> Identifying and document potential medical/</li><li>obstetrical problems so that effective therapies can be administered</li><li>Improving communication and referrals among providers</li><li>Enhancing monitoring and evaluation of outcomes, clinics, and providers</li></ul></blockquote><li>Improving efficiency, completeness, accuracy of documentation and reporting</li></ol><h2>How is ZEPRS Being Used?</h2><p>ZEPRS, an electronic-first medical records and referral system, is one of the first of its kind in sub-Saharan Africa. ZEPRS is helping medical personnel to improve care, combat the spread of HIV/AIDS, and manage records for perinatal patients and infants (antenatal through 6 weeks after delivery) in clinics, the UTH, the Lusaka District Health Management Team, and the Ministry of Health.</p><p>ZEPRS operates over a <a title="Link to map of ZEPRS wireless network in Lusaka, Zambia." href="http://ictedge.org/node/160" class="ext">27-km diameter high-speed point-to-point wireless voice and data network</a><span class="ext"></span> <span class="print-footnote">[18]</span> that interconnects 24 clinics and the UTH. A lower speed wireless network in each clinic connects at least one printer and three to nine mobile cart-mounted computers located strategically throughout the facility to support patient care. Using these computers, clinicians display and update patient records as they register and provide care to patients. Patient records are maintained in a central database at the ZEPRS data center maintained by CIDRZ.</p><p><img width="343" height="257" alt="Photo of clinicians learning to use the new ZEPRS electronic patient referral system module." title="Clinicians learning to use the new electronic patient referral system." style="float: right; margin: 10px;" class="imageborderthin" src="./zeprs_files/5534686097_dc41ea2abb.jpg"></p><p>ZEPRS achieves its objectives by providing the following:</p><ul><li>An electronic patient record system with patient record database shared among facilities</li><li>A system that guides clinicians through the Zambian standard of care</li><li>Intelligent rules that alert clinicians to problems and recommend patient referral when appropriate</li><li>Standard &amp; ad hoc reporting for supportive supervision, surveillance, analysis</li><li>An electronic-first system use by clinicians during the course of patient care</li><li>An electronic referral system to improve the efficiency and effectiveness of referrals</li></ul><p>RTI has continued working to enhance the ZEPRS software based on feedback from clinicians, and has adapted the software to meet several other needs. Recent enhancements include:</p><ul><li>an automated interface to a Laboratory Information Management System (LIMS) so that test results can be updated in patient records automatically twice daily.</li><li>an easy-to-install version that can be used in facilities independent of any network connectivity, and that transfers data and synchronizes records automatically when connectivity is present.</li><li>a version designed to <a title="Link to information about the ARV pharmaceutical supply management system in Nairobi, Kenya." href="http://ictedge.org/projects/wrKenya" class="ext">improve management of pharmaceutical supplies</a><span class="ext"></span> <span class="print-footnote">[19]</span> and that transmits data over an existing mobile phone network.</li><li>A version designed to help <a title="Link to information about the malaria Indoor Residual Spraying Application." href="http://ictedge.org/node/117" class="ext">manage malaria indoor residual spraying operations</a><span class="ext"></span> <span class="print-footnote">[20]</span>.</li><li>A version designed to help <a title="Link to information about the TIMS system in South Africa." href="http://ictedge.org/projects/rape_case_mgmt" class="ext">manage legal, medical, and psycho-social cases for rape survivors</a><span class="ext"></span> <span class="print-footnote">[21]</span> in South Africa.</li></ul><p>ZEPRS has been developed using open source software and can operate in networked or stand-alone applications. ZEPRS <strong><a title="Link to information about Zcore." href="http://www.ictedge.org/zcore">Zcore</a> <span class="print-footnote">[22]</span></strong>™ architecture permits the software to be adapted to other environments and applications. ZEPRS is free and open source software, and is available under a royalty-free license.</p><h2>More Information</h2><h4>Demos</h4><ul><li><a href="http://ictedge.org/files/screenshots/screenshots.htm" class="ext">Tour of ZEPRS features</a><span class="ext"></span> <span class="print-footnote">[23]</span></li><li><a href="http://www.ictedge.org:8080/zeprs">ZEPRS Demo</a> <span class="print-footnote">[24]</span> (Log in with username "demo" and password "demo11").</li></ul><h4>Software</h4><ul><li>The&nbsp;<a href="http://www.ictedge.org/node/788">Example software development configuration</a> <span class="print-footnote">[25]</span>&nbsp;page has the steps for downloading and configuring ZEPRS source code.&nbsp;There is no packaged download for this application, but you may access  the software source code from the subversion repository at <a title="ZEPRS Subversion source code repository." href="http://ictedge.org/repos/zeprs/">http://ictedge.org/repos/zeprs/</a> <span class="print-footnote">[26]</span>. Use this command to anonymously check out the latest project source code:<pre><span class="geshifilter"><code class="geshifilter-text">svn checkout http://www.ictedge.org/repos/zeprs/trunk zeprs-readonly</code></span>   </pre></li></ul><h4>Documentation</h4><ul><li><a href="http://ictedge.org/node/440" class="ext">Zcore Documentation</a><span class="ext"></span> <span class="print-footnote">[27]</span></li></ul><h4>Presentations</h4><ul><li><a title="Link to online presentation." href="http://ictedge.org/node/914" class="ext">The Zambian Electronic Perintal Record System: Results and Impact</a><span class="ext"></span> <span class="print-footnote">[28]</span></li><li><a title="Link to online presentation." href="http://ictedge.org/node/913" class="ext">ZEPRS: The Experience of the Zambian Electronic Perinatal Record System</a><span class="ext"></span> <span class="print-footnote">[29]</span></li></ul><h4>Maps</h4><ul><li><a title="Link to map of ZEPRS wireless network in Lusaka, Zambia." href="http://ictedge.org/node/160" class="ext">Google Map of the ZEPRS wireless network in Lusaka, Zambia</a><span class="ext"></span> <span class="print-footnote">[18]</span></li><li><a href="http://ictedge.org/files/resources/ZEPRS%20-%20Zambia%20Electronic%20Perinatal%20Record%20System.kmz" class="ext">Google Earth .kmz map of Lusaka wireless network</a><span class="ext"></span> <span class="print-footnote">[30]</span> (Note: you must have <a target="_blank" href="http://earth.google.com/index.html" class="ext">Google Earth</a><span class="ext"></span> <span class="print-footnote">[31]</span> installed in order to be able to load this file.)</li></ul><h4>Other</h4><ul><li><a href="http://en.wikipedia.org/wiki/ZEPRS" class="ext">ZEPRS on Wikipedia</a><span class="ext"></span> <span class="print-footnote">[32]</span></li><li><a href="http://www.rti.org/brochures/ict_africa_zeprs.pdf" class="ext">Using ICT to Improve Patient Care</a><span class="ext"></span> <span class="print-footnote">[33]</span> (240Kb PDF RTI brochure.)</li></ul>  </div>
<div id="node-837" class="section-2">
  <h1 class="book-heading">Offline Mode</h1>
  <p>ZEPRS-specific information about offline mode.</p><h3>Patient Sync Process (deprecated)</h3><p>This clinic "server" is configured to publish an xml file, called an
RSS feed, every 30 minutes. The Master ZEPRS server subscribes to this
clinic feed. In the same manner, the clinic pc subscribes to the main
ZEPRS server RSS feed. The RSS feed is a listing of all of the clinic’s
patient records in XML format, with modification dates. When the clinic
pc (or master server) imports an rss feed, it compares each record's
last modified date with its own patient records. If the dates are not
equal, it downloads an XML file that contains the patient record and
updates the necessary data.</p>  <div id="node-839" class="section-3">
  <h1 class="book-heading">Basic record imports</h1>
  <h2>Patient Sync (no longer in-use)</h2><p>Overview of patient record imports.</p>
<ul style="margin-top: 0in;" type="disc"><li>Every 30 minutes the site pc creates a listing of all patients w/
modification dates (called rss.xml), and updates any changed patient
xml files (The xml files is a text file which contains the patient
record in xml format). </li><li>The main ZEPRS server has "subscribed" to the patient listing of
the other pc - the rss.xml file. The import process can happen
automatically - for instance, every 30 minutes - or manually. For
example, when the user presses the "Import" link from the Subscriptions
admin page, ZEPRS reads the remote rss.xml file and compares each
patient listed in it to the lastModified field in each's patient's
record on the main ZEPRS instance's database. If the remote version
lastModified is not equal to the main ZEPRS version, ZEPRS downloads
the remote patient xml file. The automatic process happens the same
way. </li><li>The main ZEPRS instance processes the patient xml files that were
just downloaded. It processes new patients as well as changes to
current patient records. It imports all visits, system generated
outcomes, problems, etc. </li><li>The caching process is automated - the clinic (remote) instance
automatically creates every 30 minutes the data for the main ZEPRS
instance to import, as noted in the first point. </li><li>Each site is publishes an RSS feed for the patients whose records have been modified at the site. </li></ul>
<p>This process may happen in reverse: The clinic may subscribe to the
main ZEPRS feed and fetch records that had been updated for that clinic
while it was offline.</p>
<p>How does the remote site get updates of its patient records if the
record was updated at another site? The remote site feed lists all
patients it is "interested" in – basically, these are all of the
patients it actively manages – in its own RSS feed. The remote site
subscribes to the ZEPRS master site’s feed for that particular remote
site. When the remote site syncs its records, it downloads the site
feed that is generated by the ZEPRS master that currently uses the same
query as the remote site – select all patient records who were last
modified at this remote site. This sync process compares the patient
record modified dates to see if the patient record was modified on - if
they differ, the system syncs the patient record.</p>

<p>Unfortunately, this will miss any patients whose records were
updated at another site – such as transfers to UTH. So, the remote site
keep a list of its patients who were not on the list from the master
RSS feed and sync’s each of the missing patients.</p>  </div>
<div id="node-664" class="section-3">
  <h1 class="book-heading">Cleaning and updating remote instances of standalone</h1>
  <div class="field field-type-text field-field-feature-teaser">
    <div class="field-items">
            <div class="field-item odd">
                    <p>&nbsp;</p>        </div>
        </div>
</div>
<p>Login to standalone server. Stop the zeprs service if it is running:</p> <p>service zeprs stop</p>  <p>Check again that it is not running:</p> <p>ps ax|grep java</p> <p>If it is running, note the process id for the java process and kill it:</p> <p>kill -9 (process id)</p> <p>Enter the following commands to make a local connection to the database and clean it out. This will delete all of the records in the database and reset the autoincrement id's.</p> <p>export DERBY_HOME=/var/www/zeprs_standalone/derby-bin<br>cd /var/www/zeprs_standalone/databases/scripts<br>/var/www/zeprs_standalone/derby-bin/ij local_conn_clean_db.sql &gt; out.txt</p> <p>Once this script has completed, review the file out.txt for any errors.</p>  <p>more out.txt</p> <p><strong>Indications of success:</strong></p> <p>ij&gt; DELETE FROM problabor;<br>2 rows inserted/updated/deleted</p> <p>or</p> <p>ij&gt; DELETE FROM anteultrasoundeval;<br>0 rows inserted/updated/deleted<br>WARNING 02000: No row was found for FETCH, UPDATE or DELETE; or the result of a query is an empty table.</p>  <p><strong>Indications of failures:</strong><br>Look for errors that indicate&nbsp; that the script was unable to delete records due to foreign key conflicts.. Make sure that pregnancy and patient tables have successfully deleted their records - this is of the utmost importance.</p> <p>You may either page though out.txt:</p> <p>more out.txt</p> <p>or just check that patient and pregnancy have been cleared out:</p> <p>more out.txt|grep patient -A1<br>more out.txt|grep pregnancy -A1</p> <p>There is also a version of clean_db that makes a network connection to the derby database. This is useful if the server is currently running; however, the author recommends running the script when the app is not running and using the local connection.</p> <p>You may also check counts for each table to confirm using scripts/table_counts.sql. This script makes a local connection to derby. Modify the connection string at the top of the script if you need to make a network connection.</p>  <p>/var/www/zeprs_standalone/derby-bin/bin/ij table_counts.sql &gt; counts.txt</p> <p>more counts.txt</p> <p>Some of the user and site tables will have records. The author assumes you don't wish to delete records from these</p> <p>tables:</p> <ul> <li>SITE</li> <li>USER_GROUP</li> <li>USER_GROUP_MEMBERSHIP</li>  <li>USER_GROUP_ROLE</li> <li>USER_INFO</li> </ul> <p>Once you have confirmed that the derby database is clean, start zeprs</p> <p>service zeprs start</p> <p>Go to Form Admin and click "Clean Archive directories."</p> <p><img height="165" width="961" style="border: 1px solid black;" alt="Link to clean archive dirs" src="./zeprs_files/clean_archive_directories.png"></p> <p>Next you should compact the database:</p> <p><img height="157" width="961" style="border: 1px solid black;" alt="Link to view/compact derby db" src="./zeprs_files/view_derby_database_sizes.png"></p> <p>&nbsp;</p> <p>Note the large table sizes on the right side of the screenshot. Click link to Compact the database.</p>  <p><img height="351" width="933" style="border: 1px solid black;" alt="Listing of db sizes showing large table sizes" src="./zeprs_files/compact_derby_database.png"></p> <p>&nbsp;</p> <p>Result of compacting process - note zero-sized tables:</p> <p><img height="329" width="937" style="border: 1px solid black;" alt="Result of db compacting." src="./zeprs_files/compact_derby_database_done.png"></p> <p>&nbsp;</p> <p>Next, click the link to Backup the database:</p> <p><img height="154" width="945" style="border: 1px solid black;" alt="Link to backup db" src="./zeprs_files/backup_database.png"></p> <p>Result of backup operation displays the backup location:</p> <p><img height="284" width="500" style="border: 1px solid black;" alt="Display of Backup location" src="./zeprs_files/backup_database_location.png"></p> <p>Listing of files in backup directory:</p> <p><img height="129" width="612" alt="Listing of backup directory" src="./zeprs_files/backup_database_listing.png"></p> <p>&nbsp;</p> <p>Go to the master app (the ZEPRS server) and copy the url for the RSS feed for the site by going to Admin/Publisher Setup and scroll to the listing of site RSS feeds.</p>  <p><img height="376" width="682" style="border: 1px solid black;" alt="RSS feed link highlighted" src="./zeprs_files/master-rss-url-highlight.png"></p> <p>Copy the url of the standalone site's feed.</p> <p><img height="366" width="406" style="border: 1px solid black;" alt="Context menu for copying RSS url" src="./zeprs_files/copy-master-url.png"></p> <p>On the standalone app, go to Admin/Subscriptions and paste in the url of the feed:</p> <p>http://192.168.20.6:8080/archive/KAL/rss.xml</p> <p><img height="210" width="529" alt="Input box for feed subscription" src="./zeprs_files/subscribe_to_rss_feed.png"></p> <p>After saving the subscription, click Import:</p> <p><img height="308" width="680" alt="Import feed link" src="./zeprs_files/import_rss_feed.png"></p> <p>The system then returns a page that shows the "Import" link having changed to an "Update" link. In the background, the system is now importing patient records.</p> <p><img height="324" width="683" alt="Link to update feed" src="./zeprs_files/update_rss_feed.png"></p> <p>From the console, monitor progress of the import on the standalone</p>  <p>/root/tomtail.sh&nbsp; (a script that has tail -f /path-to-tomcat/logs/catalina.out)</p>  </div>
<div id="node-665" class="section-3">
  <h1 class="book-heading">Comparing remote instances with the master</h1>
  <div class="field field-type-text field-field-feature-teaser">
    <div class="field-items">
            <div class="field-item odd">
                    <p>&nbsp;</p>        </div>
        </div>
</div>
<p>During development one may confirm the accuracy of the sync process. From the master, go to Admin/Publishing and click the "Compare" link on the record for the remote site to which the master is subscribed:</p> <p><img height="420" width="627" alt="Link to Compare on subscription record" src="./zeprs_files/compare_link_0.png"></p> <p>The system requests an XML record for each patient in the Master database for that site. This record is rendered dynamically on the remote site. Using the XML record is in-lieu of connecting to the remote database directly. Elements of the patient record on the master such as all encounter recordsd are compared with the remote version. The system displays a report to the user when the analysis is complete:</p> <p><img alt="Results of compare process" src="./zeprs_files/compare-results.png"></p>  <p>The system also generates a report on the filesystem in the "syncReports" directory for the site - in this case, in webapp/archive/AIR/syncReport. It provides more detail on missing or incomplete records.The UUID of the missing patient or encounter is displays. Incorrect values and UUID for the encounter are also provided.</p> <p><img height="875" width="499" alt="XML report that displays problems w/ sync" src="./zeprs_files/compare_report_0.png"></p>  </div>
<div id="node-656" class="section-3">
  <h1 class="book-heading">Patient Home clinic</h1>
  <h2>Patient Sync (deprecated)</h2><p>This is ZEPRS-specific information. </p><p>When a patient is registered in the system, site_id is set in the
patient table. This never changes unless explicitly changed in
demographics. The site_id is usually the site id of the site that the
pc is configured for in "Setup." </p>
<p> Someone from another site may edit a patient record. This is useful
when the patient moves to another clinic, the patient is referred to
UTH, or when someone makes a correction to a patient record from
another site. The site_id field in another table - patient_status,
which holds data that often changes for the patient - is changed. If
the user is adding a new encounter, the created_site_id and site_id is
set in yet another table - encounter - and patient_status.site_id is
updated. If the user is editing a record, encounter.site_id and
patient_status.site_id is updated.</p>
<p> For the caching to work optimally, a patient must "belong" to a
single clinic. When a site is "offline," the expectation from the
system will be that a patient record will be updated in only two places:</p>
<ul type="disc">
<li>the patient's "home" clinic - the clinic the      patient belongs to</li>
<li>UTH, in case the patient was referred to another clinic      while the site is offline. </li>
</ul>  </div>
<div id="node-660" class="section-3">
  <h1 class="book-heading">RSS File Elements</h1>
  <p>RSS.class generates an XML file that lists all of the patients managed by the clinic or site. This file uses the RSS 2.0 schema.</p>
<p>Elements:</p>
<ul style="margin-top: 0in;" type="disc">
<li>&lt;title&gt;ZEP&lt;/title&gt; - site abbreviation</li>
<li>&lt;link&gt;http://192.168.20.6:8080/archive/rss.xml&lt;/link&gt;      - link to rss file for this site</li>

<li>&lt;description&gt;ZEP Patients&lt;/description&gt;</li>
<li>&lt;lastBuildDate&gt;Mon, 17 Apr 2006 16:30:01 GMT&lt;/lastBuildDate&gt; - Timestamp that this listing was generated</li>
</ul>
<p>Each patient record is nested in an &lt;item&gt; tag and has the following elements:</p>
<ul style="margin-top: 0in;" type="disc">

<li>&lt;title&gt;5040-100-00001-1.xml&lt;/title&gt; - ZEPRS ID</li>
<li>&lt;link&gt;http://192.168.0.11:8080/archive/ZEP/5040-100-00001-1.xml&lt;/link&gt;      - URL of patient XML record</li>
<li>&lt;author&gt;2&lt;/author&gt; - site id where record was      last modified.</li>

<li>&lt;pubDate&gt;Mon, 21 Nov 2005 09:10:10 GMT&lt;/pubDate&gt; - Timestamp of when this record was last modified</li>
<li>&lt;guid&gt;http://192.168.0.11:8080/archive/ZEP/5040-100-00001-1.xml&lt;/guid&gt;</li>
</ul>  </div>
<div id="node-840" class="section-3">
  <h1 class="book-heading">Subscriptions</h1>
  <div class="field field-type-text field-field-feature-teaser">
    <div class="field-items">
            <div class="field-item odd">
                    <p>&nbsp;</p>        </div>
        </div>
</div>
<p><span style="color: #ff0000;"><em>Patient Sync (no longer in-use)</em></span></p> <p>The Publisher page has a list of all site's rss feeds. Right-click on the feed's RSS url and copy. Paste this url in the subscription page to subscribe to the remote site's feed.</p> <p><img height="374" width="651" style="border: 1px solid black;" alt="Site feed links" src="./zeprs_files/site_rss_feed_link_0.png"></p>   <p>This concept is very similar to how you subscribe to a news feed or a blog on my.yahoo.com or other newsreader services. In fact, I'm using a library called Rome that is designed for this purpose. The feed and patient xml files are password protected. The log provides details of each update.</p>  <p>Update data is saved in the updatelog table.</p> <p>You may also monitor updates via the command line:</p><p><a href="http://ictedge.org/files/populate_log_0.png"><img alt="command line view of updates to patient record." src="./zeprs_files/populate_log_0_sm.png"></a> <span class="print-footnote">[34]</span></p>  </div>
<div id="node-663" class="section-3">
  <h1 class="book-heading">To do</h1>
  <p>List of items to make this system seamless:</p>

<ul style="margin-top: 0in;" type="disc">
<li>Enforce offline mode. If a clinician from an offline clinic
attempts to modify a patient record on the main ZEPRS server, ZEPRS
will re-direct user to clinic version. This will <em>not</em> prevent users      from UTH from making modifications to the patient record.<br>
<ul style="margin-top: 0in;" type="circle">
<li>Make main ZEPRS server aware when a server is "offline". </li>
<li>Create Administrative interface to list all clinics and       their offline status:<br>
<ul style="margin-top: 0in;" type="square">
<li>Clinic id</li>
<li>Timestamp when placed offline</li>
</ul>

</li>
<li>When a clinic is placed offline, offer to subscribe to that
clinic’s feed if it’s not already subscribed. When clinic is back
online, offer to import the feed.</li>
</ul>
</li>
<li>When a new build is released, go to Admin/Subscriptions and click
"Propogate Updates" link. ZEPRS will loop through the list of
Subscriptions and enable each subscribed site to initiate
downloads/installation of updates. Part of this is already in-place.</li>
</ul>  </div>
<div id="node-841" class="section-3">
  <h1 class="book-heading">Updating a current patient record</h1>
  <h2>Patient Sync (no longer in-use)</h2><p>Updates to patient records are fetched via RSS.importFeed.</p>

<p>Start w/ the patient object and compare the non-Collections items (strings and ints). Then check the following collection items:</p>
<ul style="margin-top: 0in;" type="disc"><li>patientStatusreport</li><li>sessionPatient</li><li>pregnancyList<br>
<ul style="margin-top: 0in;" type="circle"><li>Loop through encounters. Check if the uuid for each encounter is in the database; if not, add the new encounter.</li></ul>
</li><li>patientRegistration - refers to instance in pregnancyList,      so it will already be handled.</li><li>Deletions are handled the same way. ProblemArchive,
OutcomeArchive,and EncounterDataArchive have uuid's of the objects they
are deleting. </li><li>Problems and system generated outcomes work the same way - loop
through those objects, check if the uuid is in the database, add new
objects.</li></ul>
<p>Any changes to encounters are handled by looping through the EncounterValueArchive list.</p>
<p><a href="http://ictedge.org/node/669" title="Sample object update code" class="ext">Sample code</a><span class="ext"></span> <span class="print-footnote">[35]</span> for processing objects using uuid's.</p>  </div>
<div id="node-666" class="section-3">
  <h1 class="book-heading">Oflfine mode notes</h1>
  <p>List of notes:</p>
<ul>
<li>PatientRecordUtils.importEncounter - must set encounter_id for referring encounter.</li>
</ul>
<p>File locations:</p>

<ul>
<li>Store all locally-generated files - files that represent the current db values - in sitename/local</li>
<li>Store all imported files in sitename/import. If it's subscribed to the main zeprs feed, store in ZEP/import.</li>
<li>At the end of an import, store latest version of patient record in
local db at sitename/local by using PatientRecordUtils.archivePatient. <br>This uses XmlUtils.generatePatientXML to render the patient record from the database.<ul>
<li>Before this step one could save the current file in sitename/local as a backup.</li>
</ul>
</li>
</ul>
<p>When a new build is released, the system performs any necessary Application updates. See the page on <a href="http://ictedge.org/node/767" title="Updating the Application" class="ext">Updating the Application</a><span class="ext"></span> <span class="print-footnote">[36]</span>  for more information.</p>  </div>
<div id="node-667" class="section-3">
  <h1 class="book-heading">Populate master_archive on each remote instance.</h1>
  <p>Each standalone instance usually processes clients for the site
or clinic in which they operate. In some circumstances, you may wish to
have records from all patients in the system - from all sites -
available, even if the site is offline. These commands are used to
populate master_archive on each server. This archive is used for the
import patient process. There is also an automated process that updates
this archive daily.</p>
<p>command on server to create archive</p>
<pre>tar -czvf archive.tar.gz archive</pre><p>script for transferring
archive to standalone from master server. The lines marked w/ "//"
(sftp and login) are pseudocode - you'll need to perform those
operations yourself.</p>
<pre>// open sftp session
cd /var/www/zeprs_standalone/webapps
put archive.tar.gz
exit

// login to standalone
cd /var/www/zeprs_standalone/webapps
mkdir master_temp
mv archive.tar.gz master_temp
cd master_temp
tar -xzvf archive.tar.gz
mv archive master_archive
rm -rf /var/www/zeprs_standalone/webapps/master_archive 
mv master_archive ../
cd ..
rm -rf master_temp
</pre>  </div>
<div id="node-662" class="section-3">
  <h1 class="book-heading">Software Updates</h1>
  <p>Update the following items when releasing a new build:</p>
<ul style="margin-top: 0in;" type="disc">
<li>zeprs_install.sql</li>
<li>admin_install.sql</li>
<li>zeprs.war</li>
<li>deleteGen.sql</li>
</ul>
<p>Updates are placed on /var/www/html/sw/updates/ on the ZEPRS server.</p>  </div>
<div id="node-668" class="section-3">
  <h1 class="book-heading">Steps to add a new offline mode site</h1>
  <p>You will need to change the home page on all of the other pc's
at Matero ref to point to the new pc instead of the live ZEPRS site. My
main advice for implementing this new site: don't let any new patients
be created on the main ZEPRS server once you've begun changing over the
local pc's. If a new patient is created on the master ZEPRS pc by a
user at the new site who is not using the new local server, and then a
new patient is created on the new local server, both users will
probably have the same id, and the local version will not sync to the
master server due to a duplicate id problem.</p>
<p>Steps:</p>
<p>  1. All local users at the new site need to stop using ZEPRS until you complete the changeover.<br>
2. Update the local site w/ the zeprs feed: login as zepadmin to the
new site server, Go to Admin -&gt;Site subscriptions -&gt; Click
"Update ZEP".<br>    3. Change the home page to point to this new site<br>    4. Local users at the new site may resume work using the local site.</p>  </div>
<div id="node-669" class="section-3">
  <h1 class="book-heading">Sync process - example code comparing uuid's</h1>
  <p><em>The following code is for the Patient Sync method of synchronization, which is no longer in-use.</em></p><p>Loop through the current records and add them to a
Hashmap&lt;uuid,createdDate). This pattern is used for all objects in
zeprs - encounters, problems, comments, etc.</p>
<pre>Map currentCommentMap = new HashMap(); // create a hashmap that stores the uuid
if (currentComments != null) {
    // loop through the current items and pop them into Map
    for (Comment item : currentComments) {
        String uuid = item.getUuid();
        currentCommentMap.put(uuid, uuid);
    }
}
</pre>
<p>Then loop through the records you're importing and see if the uuid exists. <br>If not, set some import id's and (in some cases) the patient and pregnancy id and save the new record.</p>
<pre>for (int i = 0; i &lt; importComments.size(); i++) {
    Comment item = (Comment) importComments.get(i);
    item.setImportCommentId(item.getId());
    String uuid = item.getUuid();
    if (currentCommentMap.get(uuid) == null) {
        XmlUtils.saveImportedComment(item, conn, comments);
    }
}
</pre>
<p>Clear the map afterwards:</p>
<pre>currentCommentMap.clear();</pre>  </div>
</div>
<div id="node-858" class="section-2">
  <h1 class="book-heading">Software Development</h1>
  <p>Pages describing software development for ZEPRS.</p>  <div id="node-788" class="section-3">
  <h1 class="book-heading">Example software development configuration</h1>
  <p>Updated July 30, 2012</p><h2>Software Setup</h2><p>Here are some notes to help a developer get running with ZEPRS. Use the versions of the software (jdk, mysql) in the notes.</p><div>Install jdk 6, not jdk 7</div><div>&nbsp;</div><div>Instal Mysql: 5.1.60 community edition. Add the following to the bottom of my.ini:</div><div># zeprs</div><div>old_passwords=1</div><div>&nbsp;</div><div>If you are using a newer version of mysql and do not have my.ini, check "old_passwords" in the configurator app.</div><div>&nbsp;</div><div>Please note that if you don't have old_passwords set, authentication will not work.</div><div>&nbsp;</div><div>Install ApacheTomcat 6.0.20.</div><h2>Source Code</h2><div>Source control can be integrated with the Eclipse IDE using Subversive. The&nbsp;<a href="http://www.eclipse.org/subversive/documentation/gettingStarted/aboutSubversive/install.php" class="ext">Subversive installation instructions</a><span class="ext"></span> <span class="print-footnote">[37]</span> are a useful guide to installing Subversive. Once it is installed and you restart Eclipse, go to File -&gt; Import -&gt; SVN and choose Project from SVN. Create a new repository using the URL &nbsp;http://www.ictedge.org/repos/zeprs/trunk/. Subversive will ask if you want to normalize the URL by truncating /trunk; don't do it.&nbsp;</div><div>&nbsp;</div><div>If you are using a command-line subversion client, &nbsp;checkout the ZEPRS source code using the following comand:</div><p><span class="geshifilter"><code class="geshifilter-text">svn checkout http://www.ictedge.org/repos/zeprs/trunk zeprs-readonly</code></span></p><div>Copy the folowing files from C:\source\zcore-workspace\workspace\zeprs\lib\ to C:\Program Files\Apache Software Foundation\Tomcat 6.0\lib</div><ul><li><div>commons-dbcp-1.2.1.jar</div></li><li><div>commons-logging-1.1.jar</div></li><li><div>commons-pool-1.3.jar</div></li><li><div>log4j-1.2.13.jar</div></li><li><div>log4j.properties</div></li><li>zcore-tomcat-realm.jar (Do not use tomcat-realm-zeprs.jar; it is obsolete.)</li><li>mysql-connector-java-5.0.7-bin - Do not use&nbsp;mysql-connector-java-5.1.19-bin - this will cause problems with the population of lists.</li></ul><h2>Create the Databases</h2><div>Using the mysql command, create the zeprs, zeprsdemo, admin, mail, and userdata databases.</div><div>&nbsp;</div><div>Run the following sql scripts using the format mysql -u root db&lt;file.sql</div><ul><li>conf/template/sql/<font face="Arial, Verdana, sans-serif">zeprs-data-05032012</font>.sql - create the zeprs db - mysql -u root zeprs&lt;<font face="Arial, Verdana, sans-serif">zeprs-data-05032012</font>.sql&nbsp;</li><li>conf/template/sql/<font face="Arial, Verdana, sans-serif">zeprsdemo-data-05032012</font>.sql&nbsp;- create the zeprsdemo db - mysql -u root zeprsdemo&lt;<font face="Arial, Verdana, sans-serif">zeprsdemo-data-05032012</font>.sq</li><li>conf/template/sql/admin_install.sql - create the admin db - mysql -u root admin&lt;admin_install.sql</li><li>conf/template/sql/mail_install.sql - create the mail db - mysql -u root mail&lt;mail_install.sql</li><li>conf/template/sql/userdata_install.sql - create the userdata db - mysql -u root userdata&lt;userdata_install.sql</li></ul><div>To configure the sql permissions, open conf/template/sql/web_user.sql and view the sql for the zeprs_web_user, root users. Lines 8 - 23 lines should suffice. You will need to replace "password" with the password for zeprs_web_user in META-INF/context.xml.</div><h2>Eclipse Project Configuration</h2><div>In Eclipse, go to Build Path -&gt; Configure Build Path and point to your JDK's tools.jar.&nbsp;</div><div>Also confirm that the Server Runtime (Tomcat) points to a valid runtime. (Add Library -&gt; Server Runtime.)</div><div>Add servlet-api.jar from your tomcat/libs directory.&nbsp;</div><div>Confirm that your server runtime is in eclipse preferences -&gt; Server &nbsp;-&gt; runtime environments</div><div>In the Servers view, add zeprs to the Tomcat 6 server. Also check in the projects properties Targgeted runtimes that it is pointed to this server.</div><div>Double-click on the server in Servers view. In the Server Locations section, Use tomcat installation and change the deploy path name to webapps.&nbsp;</div><div>It helps to increase the server timeouts to 90 seconds.</div><div>&nbsp;</div><div>In Launch configuration arguments tab, put the following at the beginning of the VM arguments:</div><div>-Xms256m -Xmx1g -XX:MaxPermSize=256m&nbsp;</div><div>&nbsp;</div><div>Copy local-example.properties to local.properties and configure the settings if you do anything in ant with build.xml.&nbsp;</div><div>&nbsp;</div><div>Use Firefox to test the ZEPRS app; there is a bit of CSS work that must be done to get it to work in Chrome.&nbsp;See the&nbsp;<a href="http://ictedge.org/node/932" class="ext">ZCORE ON TOMCAT 7 AND WINDOWS 7/64 BIT</a><span class="ext"></span> <span class="print-footnote">[38]</span>&nbsp;notes if you would like to upgrade ZEPRS to Tomcat 7 and/or Chrome.</div><div>&nbsp;</div><div>Point your browser to localhost:8088/zeprs/</div><h2>Troubleshooting</h2><h3>Lib path issues&nbsp;</h3><div>When you start up the app, of you get the following error if zeprs-realm.jar is not in your tomcat/libs dir:</div><div>&nbsp;</div><div>java.lang.ClassNotFoundException: org.apache.catalina.realm.UserGroupRoleRealm</div><div>&nbsp;</div><div>If you get the error when you login:</div><div>&nbsp;</div><div>SEVERE: com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: SELECT command denied to user 'zeprs_web_user'@'localhost' for table 'accountuser'</div><div>&nbsp;</div><div>revisit web_user.sql and run the credentials for that user.</div><h3>Diagnosing Authentication Issues</h3><div>Source code and unit test for the ZcoreUserGroupRoleRealm is at&nbsp;<a href="http://www.ictedge.org/repos/ZcoreUserGroupRoleRealm/">http://www.ictedge.org/repos/ZcoreUserGroupRoleRealm/</a> <span class="print-footnote">[39]</span>&nbsp;.&nbsp;</div><div>&nbsp;</div><div>Import the project into Eclipse. Right-click on the project name and select Build Path -&gt; Configure Build Path. Confirm that the paths to the Libraries are correct.&nbsp;</div><div>&nbsp;</div><div>In src/test, open&nbsp;ZcoreUserGroupRoleRealmTest. Right click on authenticate_shouldReturnAPrincipal and choose debug configuration. The following should be in the Classpath:</div><ul><li>tomcat-juli (in your Tomcat/<strong>bin </strong>folder)</li><li>mysql-connect-java-5.0.5.jar (in your Tomcat/lib folder)</li><li>commons-logging (in your Tomcat/lib folder)</li><li>log4j.jar (in your Tomcat/lib folder)</li></ul><p>Open ZcoreUserGroupRoleRealmTest. Enter the mysql login in the "String username" and String password" fields. Enter the username/password for the ZEPRS login you wish to test in the line "Principal principal = realm.authenticate... Hit the debug button and it should pass - check the Junit tab to confirm it is green.  If the test fails, confirm that the settings in META-INF/context.xml are the same as the test config. Check the line in context.xml that starts with Realm className. Older version of this file user the name connectionName for username; change it to username:<br><span class="geshifilter"><code class="geshifilter-text">Realm className=&amp;quot;org.rti.tools.tomcat.ZcoreUserGroupRoleRealm&amp;quot;username=&amp;quot;zeprs_web_user&amp;quot;</code></span></p><p>To step through the actual code for&nbsp; ZcoreUserGroupRoleRealm, right-click on the zeprs project properties and choose Build Properties -&gt; configure build properties. In the Libraries tab open Apache Tomcat 6 library, and then open the zeprs-tomcat-realm.jar library (toggle the triangle widget). Click source attachment and edit. Browse to the location of the source code for the ZcoreUserGroupRoleRealm source code - will probably be&nbsp;/ZcoreUserGroupRoleRealm/src. Restart the app and try to login. If it fails, open src/ZcoreUserGroupRoleRealm and place a breakpoint "return this.username;"in&nbsp;the getUsername() method. Restart the app and see if it gets populated the next time you try to login.</p><div>-------------------</div><div>&nbsp;</div><p>The following pages describe a few more details on the setup for ZEPRS development.</p>  <div id="node-792" class="section-4">
  <h1 class="book-heading">Install apache HTTPD (optional)</h1>
  <p>Apache HTTPD is not required for ZEPRS to work; however, it is
common to run httpd in front of apache using mod_jk or mod_proxy. </p>

<p> Apache httpd install</p>
<ul>
<li>Select defaults for domain. Make sure it selects for All Users, port 80</li>
<li>Choose Custom install</li>
<li>When it installs, it may throw up and error about port 80 being
used. It is probably an IM app like yahoo or MSN. Also, check if "World
Wide Web Publishing" and IIS Admin services are running. Make them
Manual and stop them in Control panel. </li>
</ul>
  </div>
</div>

</div>

<div id="node-41" class="section-2">  </div>
<div id="node-789" class="section-4">
  <h1 class="book-heading">Installing MySQL</h1>
  <p>Install mysql - in instance config, choose detailed config and install as Server machine. 

</p><ul>
<li>choose "Transacitonal database only. </li>
<li>use default for inndb tablespace settings. </li>
<li>use default - Decision support (DSS)/OLAP</li>
<li>use deafult (enable tcp/ip networking on port 3306, Enable strict mode</li>
<li>Use default - Standard character set</li>
<li>Install as windows service</li>
<li>Install as windows service, choose "Launch mysql server automatically"</li>

<li>Include bin dir in windows path</li>
<li>Modify Security settings: enter ZEPRS db admin password, check "Enable root access from remote machines</li>
<li>When it says it's time to write the config files and start the
install, do not be alarmed if a message comes up saying that it wa
sunable to start the service. Wait a few moments, click retry. If it
doesn't work, try again. It took me 3 times before it work. If it just
does not work, it is fine to skip that step. </li>
<li>Shutdown mysql, and edit my.ini file. Add old_passwords=1</li>
</ul>
<p></p><p>Install the MySQL GUI tools
</p><ul>
<li>Choose complete install.</li>
</ul>

<p></p>  </div>
<div id="node-137" class="section-5">  </div>
<div id="node-790" class="section-4">
  <h1 class="book-heading">Installing Tomcat</h1>
  <p>Tomcat Install
</p><ul>
<li>Choose Full install and expand the Tomcat Selection and check Service. Check Native if you want to run the APR.Check Examples.</li>
<li>Use defaults for default install folder, HTTP connector port and Admin login</li>
<li>Choose default jre.</li>
</ul>
<p></p><p>If you choose Native, copy tcnative-1.dll to C:\windows.</p>

  </div>
<div id="node-135" class="section-5">  </div>
<div id="node-791" class="section-4">
  <h1 class="book-heading">Setting up eclipse</h1>
  <p>The goal with the eclipse install was to copy certain dirs to the new install to reduce the amount of configuration involved. Your mileage may vary due to paths differences</p> <p>Setting up eclipse:</p> <ul><li>Copy the workspace dir to c:\</li><li>copy the zeprs source to c:\source (rather than downloading it via svn).</li><li>copy the Servers dir to c:\source (a pre-configured tomcat setup)</li><li>copy xdoclet-plugins-1.0.3,tar to c:\tools. untar it.</li><li>Open eclipse</li><li>You may need to switch workspace - or not - from the file menu - to c:\workspace.</li><li>Set the default JDK</li><li>See if you need to fix the build path. Go to Preferences, Java build path, and see error message about tools.jar. Point to the one in your jdk.</li><li>Check Eclipse prefs - Ant - Runtime prefs - check Classpath Global entry to tools.jar</li><li>In Ant, right-click on task and select the Run As -&gt; Ant build... selection -&gt;Classpath tab. Check paths in add'l Tasks and support - servlet-api.jar and lsp-api.jar may be incorrect.</li><li><div>&nbsp;Set "Ant Home..." go to Window-&gt;Preferences-&gt;Ant-&gt;Runtime. Once there, click the "Ant home" button in the "Classpath" tab and browse to the ANT plugin folder in your Eclipse installation. Now hit the OK button and try to run the build file again. kudos: http://www.herrodius.com/blog/?p=42</div><ul><li><div>Check paths in resources/local.properties</div></li><li><div>Populate the db: Unrar the zeprs mysql install files.zip from the source dir and check the paths in install.bat before running it.</div><ul><li><div>Go to Windows -&gt; PRefs -&gt; Server -&gt; Installed runtimes and Edit the tomcat6 server, making sure it points to the correct server.</div></li><li><div>Configure the Servers. Open the Servers pane in the bottom part of the eclipse window, if you're using the J2EE perspective. Ideally, a tomcat6 server would be showing, but it probably isn't. It's OK. Right-click and create a new server. Point the Configuration path to Servers/tomcat6 at localhost. (This is a pre-configured version.) Choose "Use Tomcat installation" and set the Deploy path to "webapps". Save, it if lets you. Right-click on the Eclipse project and select "Refresh." This will copy everything from your zeprs source to the webapps dir.</div></li><li><div>Start tomcat - in servers pane, click on tomcat6 and press debug button</div></li><li><div>Login to ZEPRS and go to Admin. Click Create directories in archive.</div></li></ul></li></ul></li></ul>   <div id="node-138" class="section-5">&nbsp;</div><p>&nbsp;</p>  </div>


<div id="node-710" class="section-2">
  <h1 class="book-heading">ZEPRS by Section</h1>
  <p>Navigation of ZEPRS is split into the following sections:</p> <ul> <li>Home</li> <li>Demographics</li> <li>History/Dating</li> <li>Antepartum</li> <li>Safe Motherhood</li> <li>Labs</li> <li>Medications</li> <li>Problem or Labor Visit</li> <li>Postnatal/ Delivery Summary</li> <li>UTH Registry</li> <li>Problem List</li> <li>Ultrasound</li> <li>Referrals</li> <li>Reports</li> <li>Help</li> <li>Admin</li> <li>Logout</li> </ul> <p>Documentation of the sections is on-going - please click on the following links to continue.</p>  <div id="node-718" class="section-3">
  <h1 class="book-heading">Reports</h1>
  <p>Many of the reports in ZEPRS may be filtered by site and date:</p>
<p><img src="./zeprs_files/reports-filter.gif" alt="Filtering ZEPRS reports by date" title="Filtering ZEPRS reports by date" width="727" height="91"></p>
<p>The following reports are available from the filtered section:</p>
<ul>
<li>Delivery Register</li>
<li>Safe Motherhood Register - Antenatal</li>
<li>Safe Motherhood Register - Postnatal</li>
<li>Integrated VCT Register</li>
<li>Maternal Mortality Register</li>
<li>Neonatal Mortality Register</li>
<li>Birth Record</li>
<li>PMTCT Labour Ward Register</li>
<li>CBoH Health Centre Self-Assessment HIQ.1</li>
<li>Clinic Workload Report</li>
<li>Health Centre Service Delivery Aggregation HIA.2</li>
<li>Antenatal Monthly Summary Sheet</li>
<li>Delivery Summary Sheet</li>
<li>LUDHMB Maternal And Neonatal Stats</li>
<li>DHMT HIV Control</li>
</ul>
<p>Other reports are available:</p>
<p><img src="./zeprs_files/reports-list.gif" alt="List of reports with set time periods" title="List of reports with set time periods" width="445" height="278"></p>
<p>Report Screenshots:</p>
<ul class="menu">
<li class="leaf"><a href="http://ictedge.org/node/719" class="ext">Antenatal Monthly Summary Report</a><span class="ext"></span> <span class="print-footnote">[40]</span></li>
<li class="leaf"><a href="http://ictedge.org/node/723" class="ext">Safe Motherhood Register Report</a><span class="ext"></span> <span class="print-footnote">[41]</span></li>
<li class="leaf"><a href="http://ictedge.org/node/724" class="ext">Query Builder - ad-hoc reports</a><span class="ext"></span> <span class="print-footnote">[42]</span></li>
<li class="leaf"><a href="http://ictedge.org/node/720" class="ext">Daily Delivery Summary Sheet Report</a><span class="ext"></span> <span class="print-footnote">[43]</span> </li>
<li class="leaf"><a href="http://ictedge.org/node/721" class="ext">Eligible for ARV's Report</a><span class="ext"></span> <span class="print-footnote">[4]</span> </li>
<li class="leaf"><a href="http://ictedge.org/node/722" class="ext">Reflex Register Report</a><span class="ext"></span> <span class="print-footnote">[44]</span> </li>
</ul>  <div id="node-719" class="section-4">
  <h1 class="book-heading">Antenatal Monthly Summary Report</h1>
  <div class="field field-type-text field-field-feature-teaser">
    <div class="field-items">
            <div class="field-item odd">
                    <p>&nbsp;</p>        </div>
        </div>
</div>
<p>The Antenatal Monthly Summary Report provides a daily summary of indicators, with monthly totals at the bottom of the chart. Note - this screenshot has been truncated. All of the dates in the report are not displayed.</p>  <p><img src="./zeprs_files/anc-report1.gif" alt="anc report top" title="anc report top"><br><img src="./zeprs_files/anc-report2.gif" alt="anc report bottom" title="anc report bottom"></p> <table id="attachments" class="sticky-enabled">  <thead><tr><th>Attachment</th><th>Size</th> </tr></thead> <tbody>  <tr class="odd"><td><a href="./zeprs_files/anc-report1.gif" class="ext">anc-report1.gif</a><span class="ext"></span> <span class="print-footnote">[45]</span></td><td>16.09 KB</td> </tr>  <tr class="even"><td><a href="./zeprs_files/anc-report2.gif" class="ext">anc-report2.gif</a><span class="ext"></span> <span class="print-footnote">[46]</span></td><td>3.8 KB</td> </tr>  </tbody> </table>    <div id="node-117" class="section-4">&nbsp;</div>  </div>
<div id="node-720" class="section-4">
  <h1 class="book-heading">Daily Delivery Summary Sheet report</h1>
  <div class="field field-type-text field-field-feature-teaser">
    <div class="field-items">
            <div class="field-item odd">
                    <p>&nbsp;</p>        </div>
        </div>
</div>
<p><img src="./zeprs_files/daily_delivery_summary.jpg" alt="Daily Delivery Summary Sheet report" title="Daily Delivery Summary Sheet report"></p>    <div id="node-162" class="section-4">&nbsp;</div>  </div>
<div id="node-721" class="section-4">
  <h1 class="book-heading">Eligible for ARV's Report</h1>
  <div class="field field-type-text field-field-feature-teaser">
    <div class="field-items">
            <div class="field-item odd">
                    <p>&nbsp;</p>        </div>
        </div>
</div>
<p>The Eligible for ARV's report generates a listing of patient who have taken lab tests in which the CD4 count is &lt;=350 or null. If the patient also has made ARV regimen visits, relevant data such as date of last regimen visit and enrollment status are provided. Patient contact information is also listed.</p> <p>Screenshot:</p> <p><img height="371" width="1032" alt="Eligible for ARV&#39;s screenshot" src="./zeprs_files/eligible_for_arvs.png"></p>    <div class="section-4" id="node-121">&nbsp;</div>  </div>
<div id="node-724" class="section-4">
  <h1 class="book-heading">Query Builder - ad-hoc reports</h1>
  <div class="field field-type-text field-field-feature-teaser">
    <div class="field-items">
            <div class="field-item odd">
                    <p>&nbsp;</p>        </div>
        </div>
</div>
<p>The Query Builder enables the user to make ad-hoc reports in the ZEPRS application. The Query Builder uses the application's "awareness" of shared fields in order to aggregate data that is stored in multiple fields. For instance, BP values are taken in multiple forms and stored in multiple tables. Since the BP values are a "shared field," the system is able to identify those fields and make the appropriate joins.</p> <p><img title="Query builder" alt="Query builder" src="./zeprs_files/queryBuilder.gif"></p>  <p>The Field dropdown displays the tables used to query a particular field - note that some of these fields have multiple tables. These fields are "shared fields."</p> <p><img title="Query Builder Fields" alt="Query Builder Fields" src="./zeprs_files/queryBuilderFields.gif"></p> <p>Results are displayed below the form:</p> <p><img title="Query Builder results" alt="Query Builder results" src="./zeprs_files/queryBuilderResults.gif"></p> <table class="sticky-enabled" id="attachments">  <thead><tr><th>Attachment</th><th>Size</th> </tr></thead> <tbody>  <tr class="odd"><td><a href="./zeprs_files/queryBuilder.gif" class="ext">queryBuilder.gif</a><span class="ext"></span> <span class="print-footnote">[47]</span></td><td>9.15 KB</td> </tr>   <tr class="even"><td><a href="./zeprs_files/queryBuilderFields.gif" class="ext">queryBuilderFields.gif</a><span class="ext"></span> <span class="print-footnote">[48]</span></td><td>15.69 KB</td> </tr>  <tr class="odd"><td><a href="./zeprs_files/queryBuilderResults.gif" class="ext">queryBuilderResults.gif</a><span class="ext"></span> <span class="print-footnote">[49]</span></td><td>17.15 KB</td> </tr> </tbody> </table>    <div class="section-4" id="node-53">&nbsp;</div>  </div>
<div id="node-722" class="section-4">
  <h1 class="book-heading">Reflex Register</h1>
  <div class="field field-type-text field-field-feature-teaser">
    <div class="field-items">
            <div class="field-item odd">
                    <p>&nbsp;</p>        </div>
        </div>
</div>
<p>The Reflex Register has two "views" - one that show a simple listing of patients on ARV's, and a detailed report that lists each patient's ARV-related visits. When the report runs, it first fetches a list of all Counsel visits. Then it fills in the ReflexPatient object with the following data:</p> <ul>  <li>Positive HIV status from Safe Motherhood form, in case it was reported there.</li> <li>Most recent ARV Regimen visit (Visit date, CD4 count, WHO status, Referral to ART, PMTCT regimen</li> <li>Most recent CD4 count from Labs form</li> <li>Most recent Hgb status from Labs form</li> <li>Ega (pre-calculated from "daily_reflex_report " Stored procedure to hiv_report table in zeports db</li> <li>Date of next ANC visit from Routine Antenatal form (routineante table)</li> </ul> <p>For the detailed report, the system fetches data that is stored in the hiv_report table in the zeports database. The "daily_reflex_report" stored procedure runs nightly.</p> <p>Screenshot of print(abbreviated) version:</p>  <p><img height="293" width="1162" alt="Reflex Register Report - Abbreviated - screenshot" src="./zeprs_files/reflex_register.png"></p> <p>&nbsp;</p> <p>Screenshot of full version. Details of each of the client's ARV-related visits are boxed in red.</p> <p>&nbsp;</p> <p><img height="313" width="1168" alt="Full version of Eligible for ARV&#39;s report with visit data highlighted" src="./zeprs_files/reflex_register-full2.png"></p>    <div class="section-4" id="node-39">&nbsp;</div>  </div>
<div id="node-726" class="section-4">
  <h1 class="book-heading">Reporting Tips</h1>
  <p>Each table-backed form has a foreign key relationship w/
encounter.id. Notice that the encounter table has a patient_id field.
encounter.patient_id -&gt;patient.id.</p>

<p>See the zeports stored procedure sp_drugs_labs for examples of how
to build report queries. You'll see that it aggregates data from rpr,
arvregimen, safemotherhood, etc. T </p>
<p>Here's some sample queries to extract data from zeprs:</p>
<p><strong>ARV Regimen:</strong></p>
<p>SELECT date_visit, regimen_visit_date, fe1.enumeration AS
arvRegimen, referred_art_clinic, e.patient_id as patientId,
p.district_patient_id<br>FROM zeprs.arvRegimen a<br>LEFT JOIN zeprs.encounter e on e.id = a.id<br>LEFT JOIN admin.field_enumeration fe1 on fe1.id = a.regimen<br>LEFT JOIN patient p on p.id = e.patient_id<br>ORDER BY regimen_visit_date ASC;</p>
<p>Results:</p>

<p><img src="./zeprs_files/arv_query.gif" alt="arv query results" title="arv query results"> </p>
<p><strong>Count of how many visits patients w/ NVP regimens have made:</strong></p>
<p>SELECT COUNT(e.id) AS numVisits, fe1.enumeration AS arvRegimen, e.patient_id as patientId, p.district_patient_id<br>FROM zeprs.arvRegimen a<br>LEFT JOIN zeprs.encounter e on e.id = a.id<br>LEFT JOIN admin.field_enumeration fe1 on fe1.id = a.regimen<br>LEFT JOIN patient p on p.id = e.patient_id<br>WHERE fe1.enumeration = "NVP"<br>GROUP BY p.id</p>
<p>Results: </p>
<p><img src="./zeprs_files/arv_nvp_count.gif" alt="ARV NVP query results" title="ARV NVP query results"> </p>

<p style="font-weight: bold;">Interpreting Values</p>

<p>Some of the values in a record may have special meaning. See the item(s) listed in <a href="http://ictedge.org/node/699" class="ext">Interpreting values for Enumerations</a><span class="ext"></span> <span class="print-footnote">[50]</span>
for examples. When preparing a new report, it is a good idea to do a
join between pageItem.field_id and form_field.to see the input_type for
the pageItem - the values recorded may have a different meaning from
the literal value. You can view the code for a paticular input widget
from he tags directory. Also, PatientRecordUtils.resolveValue will
provide guidance.</p>
<p>&nbsp;</p>
<table id="attachments" class="sticky-enabled">
 <thead><tr><th>Attachment</th><th>Size</th> </tr></thead>
<tbody>
 <tr class="odd"><td><a href="./zeprs_files/arv_query.gif" class="ext">arv_query.gif</a><span class="ext"></span> <span class="print-footnote">[51]</span></td><td>47.96 KB</td> </tr>
<tr class="even"><td><a href="./zeprs_files/arv_nvp_count.gif" class="ext">arv_nvp_count.gif</a><span class="ext"></span> <span class="print-footnote">[52]</span></td><td>31.19 KB</td></tr>
</tbody>
</table>  </div>
<div id="node-723" class="section-4">
  <h1 class="book-heading">Safe Motherhood Register Report</h1>
  <p>Screenshot of Safe Motherhood Register report:</p>
<p><img src="./zeprs_files/smregister-ante-tn.gif" alt="Safe Motherhood register" title="Safe Motherhood register"></p>  </div>
<div id="node-725" class="section-4">
  <h1 class="book-heading">Zeports - Aggregate patient data</h1>
  <div class="field field-type-text field-field-feature-teaser">
    <div class="field-items">
            <div class="field-item odd">
                    <p>&nbsp;</p>        </div>
        </div>
</div>
<p>The zeports database de-normalises data from the main zeprs database. It is used in two cases: for the Reflex report on the live ZEPRS server, and also to create a separate data warehouse.</p> <p><b>Reflex report</b></p> <p>The stored procedure "daily_reflex_report" runs nightly on the live ZEPRS db server. The cron job is /etc/cron.daily/run_hiv_report.sh. This cron job executes a sql script called run_hiv_report.sql. These files are attached to this page.</p> <p>This script aggregates data that is stored in the hiv_report table, which is created by the stored procedure, sp_create_hiv_report_table(). This stored procedure loops through arvregimen and labType to aggregate arv, cd4, and hgb data. The value for regimen_visit_date is used for encounter_date for arvregimen; the value for dateLabRequest is used for cd4 and hgb. After that procedure has completed, sp_ega() calculates the current ega for each record and updates each record.. The SQL for both of these stored procedures is attached.</p> <p><b>Data Warehouse</b></p> <p>It is created by running the zeports_lusaka.bat file included in the reports-distro.zip archive. This batch file downloads the latest zeprs database and calls the sp_build_history stored procedure in zeports.</p> <p>If you open up the zeports database in MyManager and click on Procedures, you can see where all of the data originates.</p>  <p>sp_copy_demographics takes data from patientregistration and patient tables to demographics table.</p> <p>sp_build_history points to all of the procedures that build the other tables. sp_build_history loops through each patient in demographics table and builds the record for each patient. It executes the following stored procedures:</p> <ul> <li>sp_pregs_cn - data from prevpregnancies table - goes into history table</li> <li>sp_med_surg_hist - data from medSurgHist - goes into history table</li> <li>sp_antenatal - data from pregnancydating, routineante, initialvisit - goes into antenatal table</li> <li>sp_drugs_labs - data from safemotherhoodcare, rpr, labtest, smcounselingvisit, arvRegimen, currentmedicine - does into drugs_labs table</li> </ul> <table id="attachments" class="sticky-enabled">   <thead><tr><th>Attachment</th><th>Size</th> </tr></thead> <tbody>  <tr class="odd"><td><a href="http://ictedge.org/files/run_hiv_report.sh_.txt" class="ext">run_hiv_report.sh_.txt</a><span class="ext"></span> <span class="print-footnote">[53]</span></td><td>74 bytes</td> </tr>  <tr class="even"><td><a href="http://ictedge.org/files/sp_create_hiv_report_table.txt" class="ext">sp_create_hiv_report_table.txt</a><span class="ext"></span> <span class="print-footnote">[54]</span></td><td>3.2 KB</td> </tr>  <tr class="odd"><td><a href="http://ictedge.org/files/run_hiv_report.sql_.txt" class="ext">run_hiv_report.sql_.txt</a><span class="ext"></span> <span class="print-footnote">[55]</span></td><td>81 bytes</td> </tr>   <tr class="even"><td><a href="http://ictedge.org/files/sp_ega_encounter_date.sql_.txt" class="ext">sp_ega_encounter_date.sql_.txt</a><span class="ext"></span> <span class="print-footnote">[56]</span></td><td>1.85 KB</td> </tr> </tbody> </table>    <div id="node-62" class="section-4">&nbsp;</div>  </div>
</div>
<div id="node-716" class="section-3">
  <h1 class="book-heading">Routine Antenatal Visit</h1>
  <div class="field field-type-text field-field-feature-teaser">
    <div class="field-items">
            <div class="field-item odd">
                    <p>&nbsp;</p>        </div>
        </div>
</div>
<p>The patient typically has three routine antenatal visits. The data from these visits is entered in a chart format to ease comparison of values from visit-to-visit.</p>  <p>&nbsp;</p> <p><img src="./zeprs_files/routineante.gif" alt="Routine Antenatal Visit" title="Routine Antenatal Visit"></p> <p>&nbsp;</p> <p class="MsoNormal"><span style="font-size: 10pt; font-family: Arial; color: navy;">Capturing an accurate EGA was an important component in the ZEPRS design </span></p> <div id="node-6" class="section-3">&nbsp;</div>  </div>
<div id="node-727" class="section-3">
  <h1 class="book-heading">Safe Motherhood</h1>
  <div class="field field-type-text field-field-feature-teaser">
    <div class="field-items">
            <div class="field-item odd">
                    <p>&nbsp;</p>        </div>
        </div>
</div>
<p>The Safe Motherhood section provides forms to help track HIV/AIDS status of the mother or infant, as well as the client's counseling and regimen.</p>  <p>Clicking the link to "Safe Motherhood" (from the left nav strip) opens the Safe Motherhood form. At the top of the form are links to navigate other Safe Motherhood-related forms.</p> <p><em>Please note that this page has links to other Safe Motherhood-related forms below the following screenshots.</em></p> <p>Screenshot of links:</p> <p>&nbsp;</p> <p><img title="Links to Safe Motherhood-related forms" alt="Links to Safe Motherhood-related forms" src="./zeprs_files/safemotherhood-nav.gif"></p> <p>&nbsp;</p> <p>Screenshot of form:</p> <p>&nbsp;</p>  <p><img title="Safe Mothergood form" alt="Safe Mothergood form" src="./zeprs_files/safemotherhood.gif"></p>  <div id="node-728" class="section-4">
  <h1 class="book-heading">ARV Regimen</h1>
  <div class="field field-type-text field-field-feature-teaser">
    <div class="field-items">
            <div class="field-item odd">
                    <p>&nbsp;</p>        </div>
        </div>
</div>
<p>Screenshot:</p> <p><img height="279" width="598" title="ARV Regimen Form" alt="ARV Regimen Form" src="./zeprs_files/counseling.gif"></p> <table class="sticky-enabled" id="attachments">  <thead><tr><th>Attachment</th><th>Size</th> </tr></thead>  <tbody>  <tr class="odd"><td><a href="http://ictedge.org/files/regimen.gif" class="ext">regimen.gif</a><span class="ext"></span> <span class="print-footnote">[57]</span></td><td>15.91 KB</td> </tr> </tbody> </table>    <div class="section-4" id="node-11">&nbsp;</div>  </div>
<div id="node-729" class="section-4">
  <h1 class="book-heading">Counseling Visit</h1>
  <div class="field field-type-text field-field-feature-teaser">
    <div class="field-items">
            <div class="field-item odd">
                    <p>&nbsp;</p>        </div>
        </div>
</div>
<p>Screenshot:</p>  <p><img src="./zeprs_files/counseling.gif" alt="Counseling Form" title="Counseling Form"></p> <table id="attachments" class="sticky-enabled">  <thead><tr><th>Attachment</th><th>Size</th> </tr></thead> <tbody>  <tr class="odd"><td><a href="./zeprs_files/counseling.gif" class="ext">counseling.gif</a><span class="ext"></span> <span class="print-footnote">[58]</span></td><td>12.97 KB</td> </tr> </tbody> </table>     <div id="node-16" class="section-4">&nbsp;</div>  </div>
<div id="node-730" class="section-4">
  <h1 class="book-heading">Lab tests</h1>
  <p>To request a Lab test, select a choice from the right menu and
click the "Add Item" button to fill the "Current Selections" list.</p>
<p>Screenshot:</p>
<p><img src="./zeprs_files/lab1.gif" alt="Lab form and results" title="Lab form and results"></p>
<p>When a new lab test is submitted, the system displays a "Missing Lab Test" in the Problem list.</p>
<p>Screenshot:</p>
<p><img src="./zeprs_files/missing-lab-test.gif" alt="Missing lab results" title="Missing lab results"></p>
<p>Some of the labs provide data for reports; for example, the <a href="http://ictedge.org/node/721" title="Eligible for ARV&#39;s report" class="ext">Eligible for ARV's report</a><span class="ext"></span> <span class="print-footnote">[4]</span> may be used to help manage eligble patients. See the <a href="http://ictedge.org/node/718" title="Reports section" class="ext">Reports</a><span class="ext"></span> <span class="print-footnote">[5]</span> section for other ARV-related reports.</p>  </div>
<div id="node-731" class="section-4">
  <h1 class="book-heading">RPR</h1>
  <div class="field field-type-text field-field-feature-teaser">
    <div class="field-items">
            <div class="field-item odd">
                    <p>&nbsp;</p>        </div>
        </div>
</div>
<p>Dr. Perry Killam, who is leading the clinical implementation of ZEPRS in Lusaka, has this to say about the value of the RPR lab:</p> <p><i>RPR is supposed to be given to every pregnant mom - it’s actually one of the most cost effective interventions in obstetrics. Looking at the monthly summaries though, it’s often times not equal to the new prenatal clients (but ideally should be). Some of it has been that the test was not entered, but more likely it’s because they run out of the tests. </i></p><p>We're working on making RPR status more obvious to the user and make it easier for administrators to track RPR lab stocks. Requests for RPR tests are submitted from the Labs page; however, RPR results may be tracked from the RPR page. When a Lab Request is made for an RPR test, the system displays a "Missing RPR Screen" and link in the Problem List.</p>  <p>Screenshot (click image to view larger version):</p> <p><a href="http://ictedge.org/files/rpr.gif"><img title="RPR test" alt="RPR test" src="./zeprs_files/rpr_sm.gif"></a> <span class="print-footnote">[59]</span></p> <table class="sticky-enabled" id="attachments">  <thead><tr><th>Attachment</th><th>Size</th> </tr></thead> <tbody>  <tr class="odd"><td><a href="http://ictedge.org/files/rpr.gif" class="ext">rpr.gif</a><span class="ext"></span> <span class="print-footnote">[59]</span></td><td>21.42 KB</td> </tr>  <tr class="even"><td><a href="./zeprs_files/rpr_sm.gif" class="ext">rpr_sm.gif</a><span class="ext"></span> <span class="print-footnote">[60]</span></td><td>24.66 KB</td> </tr>  </tbody> </table>    <div class="section-4" id="node-13">&nbsp;</div>  </div>
<div id="node-732" class="section-4">
  <h1 class="book-heading">Safe Motherhood Reports</h1>
  <p>ZEPRS has reports that reflect the data entered in these forms. The following links have screenshots of a few of them.</p>
  <div id="node-15" class="section-5">  <div id="node-733" class="section-5">
  <h1 class="book-heading">PMTCT Labour Ward Register</h1>
  <div class="field field-type-text field-field-feature-teaser">
    <div class="field-items">
            <div class="field-item odd">
                    <p>&nbsp;</p>        </div>
        </div>
</div>
<p>Screenshot:</p>   <p><img title="PMTCT Labour Ward Register" alt="PMTCT Labour Ward Register" src="./zeprs_files/pmtcp-register.gif"></p> <div class="section-5" id="node-14">&nbsp;</div>  </div>
<div id="node-734" class="section-5">
  <h1 class="book-heading">Safe Motherhood Register - Antenatal</h1>
  <div class="field field-type-text field-field-feature-teaser">
    <div class="field-items">
            <div class="field-item odd">
                    <p>&nbsp;</p>        </div>
        </div>
</div>
<p>Screenshot:</p> <p>&nbsp;</p> <p><img title="Safe Motherhood Register - Antenatal" alt="Safe Motherhood Register - Antenatal" src="./zeprs_files/smregister-ante-tn.gif"></p> <table class="sticky-enabled" id="attachments">  <thead><tr><th>Attachment</th><th>Size</th> </tr></thead>  <tbody>  <tr class="odd"><td><a href="http://ictedge.org/files/smregister-ante.gif" class="ext">smregister-ante.gif</a><span class="ext"></span> <span class="print-footnote">[61]</span></td><td>31.08 KB</td> </tr>  <tr class="even"><td><a href="./zeprs_files/smregister-ante-tn.gif" class="ext">smregister-ante-tn.gif</a><span class="ext"></span> <span class="print-footnote">[62]</span></td><td>37.53 KB</td> </tr> </tbody> </table>       <div class="section-3" id="node-123">&nbsp;</div>  </div>
</div>
</div>
<div id="node-735" class="section-3">
  <h1 class="book-heading">Ultrasound Evaluation</h1>
  <div class="field field-type-text field-field-feature-teaser">
    <div class="field-items">
            <div class="field-item odd">
                    <p>&nbsp;</p>        </div>
        </div>
</div>
<p>Screenshot:</p> <p><img title="Ultrasound" alt="Ultrasound" src="./zeprs_files/ultrasound.gif"></p>     <div class="section-2" id="node-50">&nbsp;</div>  </div>
<div id="node-711" class="section-3">
  <h1 class="book-heading">Home</h1>
  <div class="field field-type-text field-field-feature-teaser">
    <div class="field-items">
            <div class="field-item odd">
                    <p>&nbsp;</p>        </div>
        </div>
</div>
<p>The ZEPRS home page enables the user to search the system using the following criteria: family name, first names, ZEPRS ID, NRC number, and the username of the health worker who last modified the patient's record. One may also narrow the query by clinic or labour patients.</p> <p><img height="384" width="640" title="Home page" alt="Home page" src="./zeprs_files/home-tn.gif"></p>  </div>
<div id="node-717" class="section-3">
  <h1 class="book-heading">Referrals</h1>
  <div class="field field-type-text field-field-feature-teaser">
    <div class="field-items">
            <div class="field-item odd">
                    <p>&nbsp;</p>        </div>
        </div>
</div>
<p>Forms may have fields - usually the disposition field -  that can trigger referrals. Examples:</p> <ul> <li>Problem      or labour visit</li> <li>Postnatal      Infant Visit</li> <li>Infant      Problem/Postnatal Visit</li>  <li>Maternal      Problem/Postnatal Visit</li> <li>Maternal      Discharge Summary</li> <li>Puerperium</li> <li>Observations  for Latent Phase of 1st Stage of Labour</li> </ul> <p>Active referrals appear in the Referral listing:</p> <p><img src="./zeprs_files/referrals.gif" alt="Referrals listing" title="Referrals listing"></p> <p>&nbsp;</p> <p>Referrals are stored in the outcomes table. The id for the referring clinic is referral_site_id. Note that site_id is updated when UTH admits the patient.</p> <p>Reasons for referrals are stored in the referral_reasons table. These fields come from the "Diagnosis" section of the referring forms. When you add a new field to this section in any of the aforementioned forms, be sure to add a corresponding field to the referral_reasons table.</p>  <table id="attachments" class="sticky-enabled">  <thead><tr><th>Attachment</th><th>Size</th> </tr></thead> <tbody>  <tr class="odd"><td><a href="./zeprs_files/referrals.gif" class="ext">referrals.gif</a><span class="ext"></span> <span class="print-footnote">[63]</span></td><td>21.1 KB</td> </tr> </tbody> </table>  </div>
<div id="node-714" class="section-3">
  <h1 class="book-heading">Partograph</h1>
  <p>The Partograph was the first use of AJAX functionality in the ZEPRS application. It has not been refactored to use the dwr-generic.js functions. The Partograph saves records outside the DynaSite system - it has its own tables and manages its own fields. Upon startup, DynaSiteObjects scans the Partograph xml files and creates a HashMap of its fields to integrate w/ Dynasite.</p>  <p>See the doc "Creating Partograph Section using DWR.doc" for information about the Partograph. The doc "ZEPRS Administration.doc" also has a section on Ajax functionality</p> <p>If session timeout becomes an issue w/ Partograph, you can set it on a session basis with HttpSession.setMaxInactiveInterval(int interval); This will only work for the specific session. We do this when the PartographAction is called - set it to 5440 seconds - 90 minutes. This means that the session will be destroyed only after 90 minutes of inactivity. Since an entry is made at least every hour, we should be fine.</p> <p>Code from PartographAction:</p> <div class="codeblock"><span class="geshifilter"><code class="geshifilter-text">session.setMaxInactiveInterval(5400);</code></span></div> <p>A <a href="http://ictedge.org/files/resources/demos/partograph" class="ext">screencam demo</a><span class="ext"></span> <span class="print-footnote">[64]</span>  is available that illustrates an early version of the partograph.</p>  <div id="node-715" class="section-4">
  <h1 class="book-heading">Partograph timing</h1>
  <div class="field field-type-text field-field-feature-teaser">
    <div class="field-items">
            <div class="field-item odd">
                    <p>&nbsp;</p>        </div>
        </div>
</div>
<p class="MsoNormal">Partograph columns are divided into 30 or 60 minute time slices. The current time slice is highlighted. The following screenshot illustrates 30 and 60 minute time slices:</p> <p class="MsoNormal"><img title="Partograph Time slices" alt="Partograph Time slices" src="./zeprs_files/parto-timeslices.gif"></p> <p class="MsoNormal">The user receives a warning if she tries to make an entry in a time slice in advance of the current time slice.</p> <p class="MsoNormal"><img title="Partograph User too fast alert" alt="Partograph User too fast alert" src="./zeprs_files/parto-toofast.gif"></p> <p class="MsoNormal">Overall timing is displayed in the right panel:</p> <p><img title="Partograph time display" alt="Partograph time display" src="./zeprs_files/parto-timing.gif"></p> <p class="MsoNormal">The code for the time slice functionality is in javascript.js.</p>  <p class="MsoNormal">When the user clicks in a column or makes a selection, the relevant javascript method calls partTimer:</p> <div class="codeblock"><span class="geshifilter"><code class="geshifilter-text">var timeSliceCheck = partTimer(interval, column);</code></span></div> <p class="MsoNormal">partTimer sets up the time slice display. If not already initialized, it calls resetTiming; otherwise, it updates it, if the user has chosen to make an entry in advance of the current timing.</p> <p class="MsoNormal">resetTiming re-initialises the timer. It calls StartTiming, which creates the loop that makes the timer work:</p> <div class="codeblock"><span class="geshifilter"><code class="geshifilter-text">setTimeout(&amp;quot;UpdateTiming()&amp;quot;,1000);</code></span></div> <p class="MsoNormal">It resets the start point for the time slices:</p> <div class="codeblock"><span class="geshifilter"><code class="geshifilter-text">time_object.this_time_slice_start = column;</code></span></div>  <p class="MsoNormal">UpdateTiming calls captures the previous value for the time slices, and calls drawTimeSlice to draw the time slice. It also updates values in time_object and displays the current time values.</p>  <div class="section-3" id="node-21">&nbsp;</div>  </div>
</div>
<div id="node-712" class="section-3">
  <h1 class="book-heading">Demographics</h1>
  <p>Screenshot of Patient Registration and Identification form - see Patient Registration secton in the <a href="http://ictedge.org/files/screenshots/screenshots.htm?div=registrationshot" class="ext">ZEPRS Tour</a><span class="ext"></span> <span class="print-footnote">[65]</span>.</p>  <table id="attachments" class="sticky-enabled">  <thead><tr><th>Attachment</th><th>Size</th> </tr></thead> <tbody>  <tr class="odd"><td><a href="http://ictedge.org/files/registration1.gif" class="ext">registration1.gif</a><span class="ext"></span> <span class="print-footnote">[66]</span></td><td>21.91 KB</td> </tr>  <tr class="even"><td><a href="http://ictedge.org/files/registration2.gif" class="ext">registration2.gif</a><span class="ext"></span> <span class="print-footnote">[67]</span></td><td>13.3 KB</td> </tr>  </tbody> </table>    <div id="node-23" class="section-3">&nbsp;</div>  </div>
<div id="node-713" class="section-3">
  <h1 class="book-heading">History/Dating</h1>
  <p>The History/Dating section provides background on the patient's medical/surgical history as well as pregnancy dating.</p> <p>Screenshots:</p> <ul> <li>History Task List in the <a href="http://ictedge.org/files/screenshots/screenshots.htm?div=taskshot" class="ext">Task Lists</a><span class="ext"></span> <span class="print-footnote">[68]</span> secton of the ZEPRS Tour</li> <li><a href="http://ictedge.org/files/screenshots/screenshots.htm?div=datingshot" class="ext">Pregnancy Dating</a><span class="ext"></span> <span class="print-footnote">[69]</span> secton of the ZEPRS Tour</li> <li><a href="http://ictedge.org/node/683" class="ext">Navigating Pregnancies</a><span class="ext"></span> <span class="print-footnote">[70]</span></li> </ul>  </div>
</div>
<div id="node-708" class="section-2">
  <h1 class="book-heading">ZEPRS API: Useful Methods</h1>
  <p>List of useful methods in the ZEPRs API</p>  <div id="node-709" class="section-3">
  <h1 class="book-heading">Parity and Gravida</h1>
  <p>ZEPRS has two methods used for calculating parity and gravida in
PatientRecordUtils class. We do not store this data in the database. </p>  </div>
</div>
<div id="node-873" class="section-2">
  <h1 class="book-heading">Administration</h1>
  <p>Placeholder section for pages specific to administration of ZEPRS.</p>  <div id="node-767" class="section-3">
  <h1 class="book-heading">Updating the Application</h1>
  <p>There are two types of update mechanisms:</p>

<ul>
<li>DynasiteChanges - manages updates to form elements</li>

<li>ApplicationUpdates - manages changes to the database.</li>
</ul>

<p>DynasiteChanges are only applied to the instance that is
creating or modifying forms - these changes are not applied to
remote instances; instead, the changes are carried over via the
re-generated Java class files and XML files.</p>

<p>Application updates are rendered on remote instances of the
application for processes such as adding new fields to a database
table.</p>

<p><strong>Application Updates</strong></p>

<p>ZEPRS has an automated method of provided updates to the
application schema, called <em>Application Updates</em>. Whenever
a new form or field is added to the system via the Administrative
interface, the system automatically creates and applies the SQL
code necessary for the change. It then creates a log of this
change in both the admin database and in an XML file.</p>

<p>Log view:</p>

<p><img src="./zeprs_files/image002.jpg" width="576" height="174"></p>



<p>Close-up:</p>

<p><img src="./zeprs_files/image004.jpg" width="576" height="25"></p>

<p>When the application is restarted, it checks this log of
updates and ensures that the current version has applied all of
the intended updates. This is especially useful when using the application in a distributed network, where there may be multiple versions of
it (offline mode). The system prints a log when it applies an
application update:</p>

<p class="code">2006-09-08 <span class="GramE">11:16</span><span class="GramE">:39,616 INFO</span>
<span class="SpellE">org.cidrz.webapp.dynasite.utils.admin.UpdateDatabase</span>
(line 70) - Application Updates: 1</p>

<p>See "<a href="http://ictedge.org/node/742" class="ext">Creating/Installing Updates to
ZEPRS</a><span class="ext"></span> <span class="print-footnote">[71]</span> " for more information on this process.</p>

<p>You may also "schedule" SQL updates in situations where the
system did not/cannot generate the SQL. Click "SQL Console" in
the Admin interface:</p>

<p><img src="./zeprs_files/image006.jpg" width="576" height="440"></p>  <div id="node-768" class="section-4">
  <h1 class="book-heading">Updating constraints</h1>
  <p>This is mysql-specific: Sometimes you need to update the foreign
key constraint. First drop the key, then add it with the new constraint
requirements, such as on update cascade:</p>
<p>ALTER TABLE zeprs.patient DROP FOREIGN KEY FKD0D3EB057D2B7913; <br>ALTER TABLE zeprs.patient ADD CONSTRAINT FKD0D3EB057D2B7913 FOREIGN KEY (`site_id`) REFERENCES `site` (`id`) ON UPDATE CASCADE; </p>

<p>You may add this type of sql statement into the App updates sql
console in the admin section to have this automatically run when the
app starts.<br>
</p>
<div id="node-139" class="section-3">  </div>
</div>
</div>
<div id="node-736" class="section-2">
  <h1 class="book-heading">Printing Records</h1>
  <div class="field field-type-text field-field-feature-teaser">
    <div class="field-items">
            <div class="field-item odd">
                    <p>&nbsp;</p>        </div>
        </div>
</div>
<p>Printing records is avoided as much as possible; however, printed Antenatal and Postnatal summary sheets are provided to patients in Lusaka. Links to these sheets are available from the Demographics page.</p> <p>ANC card screenshot (click image for larger version):</p> <p><a href="http://ictedge.org/files/anc-card.gif"><img title="ANC card" alt="ANC card" src="./zeprs_files/anc-card_med.gif"></a> <span class="print-footnote">[72]</span></p>  </div>
<div id="node-742" class="section-2">
  <h1 class="book-heading">Creating &amp; Installing ZEPRS Updates</h1>
  <p>To create an update to ZEPRS, issue the following ant commands:</p> <ul> <li>delete-before-build - Cleans up compiled jsp's and tomcat work dir</li> <li>dist-zip - Copies necessary files and builds war and distribution zip.</li> </ul> <p>The dist-zip ant call depends on all-jsp to compile jsp's. It also numbers each build; therefore, the final zip will be named zeprs_n.zip. This zip and its war are placed in your /build dir. Older versions are copied to /zeprs-war.</p> <p>To install ZEPRS on the server, ftp the file to /home/staff/zeprs. Follow the instrctions in update_lusaka.sh. This shell script will copy the war file and update the admin db. If you used the Admin app to update any forms/fields, these will be updated when ZEPRS restarts. DynaConfigServlet runs when ZEPRS starts and calls UpdateDatabase, which issues any new commands stored in the appupdate table.</p> <p>To install the ZEPRS app on a remote server, you may use the Tomcat Administration app to deploy the new war. You'll need to manually update the admin database.</p>  <div id="node-743" class="section-3">
  <h1 class="book-heading">Diagnosing problems with builds</h1>
  <div class="field field-type-text field-field-feature-teaser">
    <div class="field-items">
            <div class="field-item odd">
                    <p>&nbsp;</p>        </div>
        </div>
</div>
<p>After deploying a new build, you may get a message from users that the system will not assign new id's. This indicates that the AJAX capabilities, provided by DWR, are not working. Install the deployed build on your dev system and test the main Patient Registration page, using Firebugs extension to log javascript errors. If the error "DWREngine is not defined" is displayed, then there is a good chance the jsp's did not properly pre-compile - in fact, engine2,jsp may not have been compiled or copied over all all.</p> <p><img title="DWR Egine error message" alt="DWR Egine error message" src="./zeprs_files/DWREgine-error.png"></p> <p>Also look for the following error in the tomcat logs (localhost.yyy-mm-dd.log) -</p>  <div class="codeblock"><span class="geshifilter"><code class="geshifilter-text">&nbsp;Jun 16, 2008 10:49:50 AM org.apache.catalina.core.ApplicationContext log INFO: Marking servlet org.apache.jsp.js.engine2_jsp as unavailable </code></span></div> <div class="codeblock"><span class="geshifilter"><code class="geshifilter-text">Jun 16, 2008 10:49:50 AM org.apache.catalina.core.ApplicationContext log &nbsp;SEVERE: Error loading WebappClassLoader &nbsp; &nbsp;</code></span></div> <div class="codeblock"><span class="geshifilter"><code class="geshifilter-text">delegate: false &nbsp; &nbsp;</code></span></div> <div class="codeblock"><span class="geshifilter"><code class="geshifilter-text">repositories: &nbsp; &nbsp; &nbsp;</code></span></div> <div class="codeblock"><span class="geshifilter"><code class="geshifilter-text">/WEB-INF/classes/ &nbsp;</code></span></div> <div class="codeblock"><span class="geshifilter"><code class="geshifilter-text">----------&amp;gt; Parent Classloader: &nbsp;</code></span></div> <div class="codeblock"><span class="geshifilter"><code class="geshifilter-text">org.apache.catalina.loader.StandardClassLoader@17f1ba3 &nbsp; </code></span></div>  <div class="codeblock"><span class="geshifilter"><code class="geshifilter-text">org.apache.jsp.js.engine2_jsp &nbsp;java.lang.ClassNotFoundException: org.apache.jsp.js.engine2_jsp &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </code></span></div> <div class="codeblock"><span class="geshifilter"><code class="geshifilter-text">&nbsp;at org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1358) &nbsp;</code></span></div> <p>That code indicates that the engine2.jsp file was not compiled and/or copied over to the new build war.</p>     <div class="section-2" id="node-65">&nbsp;</div>  </div>
</div>
<div id="node-795" class="section-2">
  <h1 class="book-heading">ZEPRS Team</h1>
  <p><strong>RTI Development Team</strong><br>Eileen Reynolds, Project Manager<br>Chris E. Kelley, Senior Software Developer<br>Niamh Darcy, Senior Technical Advisor<br>Pablo Destefanis, Senior Networking and Telecommunications Specialist<br>Gordon M. Cressman, Senior Project Advisor</p> <p><strong>Lusaka Technical Support Staff</strong><br>Dennis Nkula, Zambia Project Coordinator<br>Francis Banda, Technical Support Specialist<br>Jamie Mwanza, Technical Support Specialist</p> <p><strong>Center for Infectious Disease Research in Zambia</strong><br>Dr. Jeffrey Stringer, MD, Director, Co-Investigator<br>Dr. Perry Killam, MD, Project Advisor<br>Harmony Fusco, Project Manager<br>Chafye Siulata, Project Assistant</p> <p><strong>UAB Team</strong><br>Dr. Robert L. Goldenberg, MD, Principal Investigator<br>Dr. Dwight Rouse, MD, Co-Investigator<br>Dr. Sten Vermund, MD, Co-Invesigator<br>Dr. Francis Nuthalpathy, Health Informatics Advisor<br>Dr. Alan Tita, Health Informatics Advisor</p> <p><strong>Zambian Medical Advisors</strong><br>Dr. Moses Sinkala, MD<br>Dr. Elwyn Chomba, MD<br>Dr. Ben Chirwa, MD<br>Dr. Henri Phiri, MD<br>Dr. Christopher Ngandwe, MD<br>Dr. Chipepo Kankasa, MD<br>Dr. Macha, MD<br>Dr. Mpundu Makasa, MD</p>  </div>
<div id="node-817" class="section-2">
  <h1 class="book-heading">Progress Reports</h1>
  <p>Progress reports are available for tracking the development of ZEPRS.</p> <p>Final Report - June 2006</p> <ul> <li><a href="http://ictedge.org/files/ZEPRS%20Final%20Report%20061406%20-%20gmc.pdf" class="ext">PDF</a><span class="ext"></span> <span class="print-footnote">[73]</span> (3.65MB)</li> </ul> <p>Final Technical Report, Extension - November 2006</p> <ul> <li><a href="http://ictedge.org/files/Zambia_08330_Final_report_extension-phase-2006-final-OO.html" class="ext">Html</a><span class="ext"></span> <span class="print-footnote">[74]</span> (286KB)</li> <li><a href="http://ictedge.org/files/zeprs_final_report_ext_phase2006.pdf" class="ext">PDF</a><span class="ext"></span> <span class="print-footnote">[75]</span> (285.87 KB)</li> </ul>  </div>
</div>
</div>
    <div class="print-taxonomy"></div>
    <div class="print-footer">      <div class="bottom_logo"><a href="http://www.rti.org/ict"><img src="./zeprs_files/logo_bottom.png" alt="logo" class="png"></a></div>
      <p>RTI International, P.O. Box 12194, 3040 Cornwallis Rd., Research Triangle Park, NC 27709.<br>
        ©2011 RTI International. All Rights Reserved. RTI International is a trade name of Research Triangle Institute.</p>
    

<div id="block-menu-menu-footer-social" class="block block-menu odd first grid16-8">
  <div class="inner clearfix">
            <h2 class="title block-title">Footer Social</h2>
        <div class="content clearfix">
      <ul class="menu"><li class="leaf first"><a href="http://ictedge.org/feed" title="" class="menu_icon menu-3086 ext">RSS</a><span class="ext"></span></li>
<li class="leaf"><a href="http://www.flickr.com/photos/59297423@N03/sets/72157626153872663/show/" title="View the ICT@RTI Flickr PhotoStream." class="menu_icon menu-3087 ext" target="_blank">Flickr</a><span class="ext"></span></li>
<li class="leaf"><a href="http://www.facebook.com/rti.international" title="Visit the RTI International Facebook page." class="menu_icon menu-3088 ext" target="_blank">Facebook</a><span class="ext"></span></li>
<li class="leaf last"><a href="https://twitter.com/#!/ICTatRTI" title="Link to ICTatRTI on Twitter." class="menu_icon menu-3089 ext" target="_blank">Twitter</a><span class="ext"></span></li>
</ul>    </div>
  </div>
</div>

<div id="block-menu-menu-footer-about" class="block block-menu even  last grid16-8">
  <div class="inner clearfix">
            <h2 class="title block-title">Footer About</h2>
        <div class="content clearfix">
      <ul class="menu"><li class="leaf first"><a href="http://ictedge.org/privacypolicy" title="Link to legal information Privacy Policy" class="ext">Privacy Policy</a><span class="ext"></span></li>
<li class="leaf"><a href="http://ictedge.org/termsofuse" title="Legal link to the terms of Use" class="ext">TERMS OF USE</a><span class="ext"></span></li>
<li class="leaf"><a href="http://ictedge.org/aboutsite" title="This links to the about this site page" class="ext">About This Site</a><span class="ext"></span></li>
<li class="leaf last"><a href="http://ictedge.org/contact" title="This links to the contact us form" class="ext">CONTACT US</a><span class="ext"></span></li>
</ul>    </div>
  </div>
</div>
</div>
    <hr class="print-hr">
    <div class="print-source_url"><strong>Source URL:</strong> <a href="http://ictedge.org/zeprs/book" class="ext">http://ictedge.org/zeprs/book</a><span class="ext"></span></div>
    <div class="print-links"><p><strong>Links:</strong><br>[1] http://ictedge.org/zdocs<br>
[2] http://ictedge.org/node/689<br>
[3] http://ictedge.org/node/727<br>
[4] http://ictedge.org/node/721<br>
[5] http://ictedge.org/node/718<br>
[6] http://ictedge.org/files/resources/zeprs_documentation/zeprs-schema.htm<br>
[7] http://www.webyog.com/en/<br>
[8] http://ictedge.org/node/756<br>
[9] http://ictedge.org/files/resources/demos/sharedFields<br>
[10] http://ictedge.org/files/zeprs_fields.xls<br>
[11] http://ictedge.org/files/zeprs_shared_fields.xls<br>
[12] http://ictedge.org/node/165<br>
[13] http://ictedge.org/files/arv_model.gif<br>
[14] http://ictedge.org/files/zeprs_referral_launch_medium.jpg<br>
[15] http://www.cidrz.org/<br>
[16] http://www.uab.edu/uasom/research/html/center_rschwomenshlth.htm<br>
[17] http://www.gatesfoundation.org/global-health/Pages/overview.aspx<br>
[18] http://ictedge.org/../node/160<br>
[19] http://ictedge.org/../projects/wrKenya<br>
[20] http://ictedge.org/../node/117<br>
[21] http://ictedge.org/../projects/rape_case_mgmt<br>
[22] http://www.ictedge.org/zcore<br>
[23] http://ictedge.org/files/screenshots/screenshots.htm<br>
[24] http://www.ictedge.org:8080/zeprs<br>
[25] http://www.ictedge.org/node/788<br>
[26] http://ictedge.org/repos/zeprs/<br>
[27] http://ictedge.org/../node/440<br>
[28] http://ictedge.org/../node/914<br>
[29] http://ictedge.org/../node/913<br>
[30] http://ictedge.org/files/resources/ZEPRS%20-%20Zambia%20Electronic%20Perinatal%20Record%20System.kmz<br>
[31] http://earth.google.com/index.html<br>
[32] http://en.wikipedia.org/wiki/ZEPRS<br>
[33] http://www.rti.org/brochures/ict_africa_zeprs.pdf<br>
[34] http://ictedge.org/files/populate_log_0.png<br>
[35] http://ictedge.org/node/669<br>
[36] http://ictedge.org/node/767<br>
[37] http://www.eclipse.org/subversive/documentation/gettingStarted/aboutSubversive/install.php<br>
[38] http://ictedge.org/node/932<br>
[39] http://www.ictedge.org/repos/ZcoreUserGroupRoleRealm/<br>
[40] http://ictedge.org/node/719<br>
[41] http://ictedge.org/node/723<br>
[42] http://ictedge.org/node/724<br>
[43] http://ictedge.org/node/720<br>
[44] http://ictedge.org/node/722<br>
[45] http://ictedge.org/files/anc-report1.gif<br>
[46] http://ictedge.org/files/anc-report2.gif<br>
[47] http://ictedge.org/files/queryBuilder.gif<br>
[48] http://ictedge.org/files/queryBuilderFields.gif<br>
[49] http://ictedge.org/files/queryBuilderResults.gif<br>
[50] http://ictedge.org/node/699<br>
[51] http://ictedge.org/files/arv_query.gif<br>
[52] http://ictedge.org/files/arv_nvp_count.gif<br>
[53] http://ictedge.org/files/run_hiv_report.sh_.txt<br>
[54] http://ictedge.org/files/sp_create_hiv_report_table.txt<br>
[55] http://ictedge.org/files/run_hiv_report.sql_.txt<br>
[56] http://ictedge.org/files/sp_ega_encounter_date.sql_.txt<br>
[57] http://ictedge.org/files/regimen.gif<br>
[58] http://ictedge.org/files/counseling.gif<br>
[59] http://ictedge.org/files/rpr.gif<br>
[60] http://ictedge.org/files/rpr_sm.gif<br>
[61] http://ictedge.org/files/smregister-ante.gif<br>
[62] http://ictedge.org/files/smregister-ante-tn.gif<br>
[63] http://ictedge.org/files/referrals.gif<br>
[64] http://ictedge.org/files/resources/demos/partograph<br>
[65] http://ictedge.org/files/screenshots/screenshots.htm?div=registrationshot<br>
[66] http://ictedge.org/files/registration1.gif<br>
[67] http://ictedge.org/files/registration2.gif<br>
[68] http://ictedge.org/files/screenshots/screenshots.htm?div=taskshot<br>
[69] http://ictedge.org/files/screenshots/screenshots.htm?div=datingshot<br>
[70] http://ictedge.org/node/683<br>
[71] http://ictedge.org/node/742<br>
[72] http://ictedge.org/files/anc-card.gif<br>
[73] http://ictedge.org/files/ZEPRS%20Final%20Report%20061406%20-%20gmc.pdf<br>
[74] http://ictedge.org/files/Zambia_08330_Final_report_extension-phase-2006-final-OO.html<br>
[75] http://ictedge.org/files/zeprs_final_report_ext_phase2006.pdf<br>
</p></div>
  

<div id="window-resizer-tooltip" style="display: block;"><a href="http://ictedge.org/zeprs/book#" title="Edit settings" style="background-image: url(chrome-extension://kkelicaakdanhinjdeammmilcgefonfh/images/icon_19.png);"></a><span class="tooltipTitle">Window size: </span><span class="tooltipWidth" id="winWidth">1629</span> x <span class="tooltipHeight" id="winHeight">1024</span><br><span class="tooltipTitle">Viewport size: </span><span class="tooltipWidth" id="vpWidth">1629</span> x <span class="tooltipHeight" id="vpHeight">885</span></div></body></html>